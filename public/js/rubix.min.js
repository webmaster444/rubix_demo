function d3_scale_ordinal_invert(t){var i=this.range().concat(),s=this.domain().concat();return i.sort(function(t,i){return t>i?1:t===i?0:-1}),s.sort(function(t,i){return t>i?1:t===i?0:-1}),s[d3.bisect(i,t)-1]}window.Rubix=window.Rubix||{},function(t){var i,s,e=t.event;i=e.special.debouncedresize={setup:function(){t(this).on("resize",i.handler)},teardown:function(){t(this).off("resize",i.handler)},handler:function(t,a){var r=this,o=arguments,h=function(){t.type="debouncedresize",e.dispatch.apply(r,o)};s&&clearTimeout(s),a?h():s=setTimeout(h,i.threshold)},threshold:150}}(jQuery),function(t){var i,s,e,a=t.event,r={_:0},o=0;i=a.special.throttledresize={setup:function(){t(this).on("resize",i.handler)},teardown:function(){t(this).off("resize",i.handler)},handler:function(h,n){var l=this,d=arguments;s=!0,e||(setInterval(function(){(++o>i.threshold&&s||n)&&(h.type="throttledresize",a.dispatch.apply(l,d),s=!1,o=0),o>9&&(t(r).stop(),e=!1,o=0)},30),e=!0)},threshold:0}}(jQuery),$.fn.serializeObject=function(){"use strict";var t={},i=function(i,s){var e=t[s.name];void 0!==e&&null!==e?$.isArray(e)?e.push(s.value):t[s.name]=[e,s.value]:t[s.name]=s.value};return $.each(this.serializeArray(),i),t};var RubixListeners=[],isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,useTable=isSafari?"inline":"table";Rubix=function(t,i){this.chart_counter=0,this.master_id=this.uid("master_id"),RubixListeners.push(this.master_id),this.data_stack={},this.chart_stack={},this.area_stack_data_stack=[],this.column_stack_data_stack=[],this.root_elem=$(t),this.root_elem.css("position","relative"),this.root_elem.addClass("rubixcc-main-chart"),this.root_elem.append('<div class="rubixcc-tooltip"></div>'),this.root_elem.append('<div class="rubixcc-title"></div>'),this.root_elem.append('<div class="rubixcc-subtitle"></div>'),this.root_elem.append('<div class="rubixcc-chart text-center"><div style="margin-top:5px">Loading...</div></div>'),this.root_elem.append('<div class="rubixcc-legend"></div>');var s=i.width||"100%",e=i.height||150;this.root_elem.width(s).height(e),this.elem=this.root_elem.find(".rubixcc-chart"),i.tooltip=i.tooltip||{},this.tooltip=this.root_elem.find(".rubixcc-tooltip"),this.tooltip.hide(),i&&i.tooltip&&i.tooltip.animate&&this.tooltip.addClass("animate"),this.tooltip.html(""),this.tooltip.css({"font-family":'Lato, "Lucida Grande", Arial, Helvetica, sans-serif',"font-size":"12px",position:"absolute",background:"white",color:"#89949B",padding:"10px 15px",display:"none","pointer-events":"none","border-radius":"5px","z-index":100,"min-height":50,"user-select":"none",cursor:"default",border:"3px solid "+(i.tooltip.color?i.tooltip.color:"#89949B"),"box-shadow":"rgba(0, 0, 0, 0.2) 2px 4px 8px",background:"white"}),i.legend=i.legend||{},this.legend=this.root_elem.find(".rubixcc-legend"),this.legend.css({"font-family":"Lato, 'Lucida Grande', Arial, Helvetica, sans-serif","text-align":"center","margin-top":i.legend.top||"-10px","margin-bottom":i.legend.bottom||"5px","user-select":"none",display:i.hideLegend?"none":"block"}),this.title=this.root_elem.find(".rubixcc-title"),this.subtitle=this.root_elem.find(".rubixcc-subtitle"),this.title.css({"font-family":"Lato, 'Lucida Grande', Arial, Helvetica, sans-serif","text-align":"center","user-select":"none","font-weight":"bold","font-size":"16px",color:"steelblue","margin-top":"10px",cursor:"default"}),this.subtitle.css({"font-family":"Lato, 'Lucida Grande', Arial, Helvetica, sans-serif","text-align":"center","user-select":"none","font-size":"12px",color:"steelblue","margin-top":"5px",cursor:"default",opacity:.8,"font-weight":"bold"});var a=this;this.tooltip.on({mouseover:function(t){d3.select(a.elem.find(".overlay").get(0)).node().__onmousemove(t)},mousemove:function(t){d3.select(a.elem.find(".overlay").get(0)).node().__onmousemove(t)},mouseout:function(t){$(this).hide()}}),this.elem.css({width:"100%",height:parseInt(this.root_elem.get(0).style.height),"user-select":"none",cursor:"default",position:"relative"}),this.root_elem.css("height","100%"),this.opts=i||{},this.data={},this.charts={},this.extent=[],this.extent_coordinates=[],this.is_touch_device="ontouchstart"in document.documentElement,this.d3_eventSource=function(){for(var t,i=d3.event;t=i.sourceEvent;)i=t;return i},this.custom_interpolations={sankey:function(t){for(var i,s,e,a=t[0][0],r=t[0][1],o=[a,",",r],h=0,n=t.length;++h<n;)i=t[h][0],s=t[h][1],e=(a+i)/2,o.push("C",e,",",r," ",e,",",s," ",i,",",s),a=i,r=s;return o.join("")}},this.xlabelcolor="steelblue",this.ylabelcolor="steelblue",this.first_time=!0,this.last_render=null,this.data_changed=!1,this.setup()},Rubix.prototype.setup=function(){this._setupOpts(),this._setupOnce(),this._setupRedraw(),this.draw()},Rubix.prototype.draw=function(){if(!this.data_changed){if(null!==this.last_render&&Date.now()-this.last_render<300)return;this.last_render=Date.now()}this.data_changed=!1,this.root_elem.is(":visible")&&this._draw()},Rubix.prototype.uid=function(t){return"rubixcc-"+t+"-"+Math.floor(2147483648*Math.random()).toString(36)},Rubix.prototype._setupOpts=function(){if(this.opts.theme_style=this.opts.theme_style||$("body").attr("data-theme")||"light",this.opts.theme_style_color=this.opts.gridColor||("light"===this.opts.theme_style?"#C0D0E0":"#555"),this.opts.theme_focus_line_color=this.opts.focusLineColor||("light"===this.opts.theme_style?"#C0D0E0":"#888"),this.opts.tickColor=this.opts.tickColor||("light"===this.opts.theme_style?"#666":"#999"),this.opts.titleColor=this.opts.titleColor||"steelblue",this.opts.subtitleColor=this.opts.subtitleColor||"steelblue",this.opts.legend_color_brightness=this.opts.legend_color_brightness||.5,this.title.css("color",this.opts.titleColor),this.subtitle.css("color",this.opts.subtitleColor),"dark"!==this.opts.theme_style&&"dark"!==this.opts.tooltip.theme_style||this.tooltip.css({color:"#aaa","font-weight":"bold",border:"1px solid #222","background-color":"#303030"}),this.opts.margin=this.opts.margin||{},this.margin={top:this.opts.margin.top>=0?this.opts.margin.top:25,left:this.opts.margin.left>=0?this.opts.margin.left:25,right:this.opts.margin.right>=0?this.opts.margin.right:12.5,bottom:this.opts.margin.bottom>=0?this.opts.margin.bottom:25},this.opts.draw=this.opts.draw||{},this.opts.draw={grid:!1!==this.opts.draw.grid},this.opts.invertAxes=this.opts.invertAxes||!1,this.opts.axis=this.opts.axis||{},this.opts.axis.x=this.opts.axis.x||{},this.opts.axis.y=this.opts.axis.y||{},this.axis={x:{type:this.opts.axis.x.type||"linear",range:this.opts.axis.x.range||"",tickCount:this.opts.axis.x.tickCount,tickFormat:this.opts.axis.x.tickFormat||"",label:this.opts.axis.x.label||"",labelColor:this.opts.axis.x.labelColor||"steelblue"},y:{type:this.opts.axis.y.type||"linear",range:this.opts.axis.y.range||"",tickCount:this.opts.axis.y.tickCount,tickFormat:this.opts.axis.y.tickFormat||"",label:this.opts.axis.y.label||"",labelColor:this.opts.axis.y.labelColor||"steelblue"}},this.xlabelcolor=this.opts.axis.x.labelColor,this.ylabelcolor=this.opts.axis.y.labelColor,this.axis.x.label.length&&(this.opts.invertAxes?this.margin.left+=15:this.margin.bottom+=15),this.axis.y.label.length&&(this.opts.invertAxes?this.margin.bottom+=15:this.margin.left+=15),this.margin.defaultLeft=this.margin.left,this.opts.tooltip=this.opts.tooltip||{},this.opts.tooltip.format=this.opts.tooltip.format||{},this.opts.tooltip.abs=this.opts.tooltip.abs||{},this.tooltipFormatter={format:{x:this.opts.tooltip.format.x||"",y:this.opts.tooltip.format.y||""},abs:{x:!!this.opts.tooltip.abs.hasOwnProperty("x")&&this.opts.tooltip.abs.x,y:!!this.opts.tooltip.abs.hasOwnProperty("y")&&this.opts.tooltip.abs.y}},this.opts.invertAxes){var t=this.axis.x;this.axis.x=this.axis.y,this.axis.y=t;var i=this.tooltipFormatter.format.x;this.tooltipFormatter.format.x=this.tooltipFormatter.format.y,this.tooltipFormatter.format.y=i}switch(0!==this.opts.animationSpeed&&(this.animationSpeed=this.opts.animationSpeed||750),this.opts.interval=this.opts.start_interval||0,this.stacked=this.opts.stacked||!1,this.grouped=this.opts.grouped||!1,this.offset=this.opts.offset||"zero",this.order=this.opts.order||"default",this.show_markers=this.opts.show_markers||!1,this.resize=this.opts.resize||"debounced",this.interpolate=this.opts.interpolate||"linear",this.interpolate){case"sankey":this.interpolate=this.custom_interpolations[this.interpolate]}this.master_detail=this.opts.master_detail||!1,this.master_detail_height=this.opts.master_detail_height||50,this.master_detail&&(this.master_detail_margin_bottom=this.margin.bottom,this.margin.bottom=2*this.margin.bottom+this.master_detail_height),this.opts.title=this.opts.title||"",this.opts.subtitle=this.opts.subtitle||"",this.title.html(this.opts.title),this.subtitle.html(this.opts.subtitle),(this.opts.title.length||this.opts.subtitle.length)&&this.elem.css("margin-top","-20px"),this.opts.title.length?this.title.show():this.title.hide(),this.opts.subtitle.length?this.subtitle.show():this.subtitle.hide()},Rubix.prototype._setupOnce=function(){this.area_stack_data=[],this.area_stack=d3.layout.stack(),this.area_stack.offset(this.offset),this.area_stack.order(this.order),this.area_stack.values(function(t){return t.values}),this.area_stack.x(function(t){return t.x}),this.area_stack.y(function(t){return t.y}),this.area_stack.out(function(t,i,s){t.y0=i,t.y_new=s}),this.column_stack_data=[],this.column_stack=d3.layout.stack(),this.column_stack.offset("zero"),this.column_stack.order("default"),this.column_stack.values(function(t){return t.values}),this.column_stack.x(function(t){return t.x}),this.column_stack.y(function(t){return t.y}),this.column_stack.out(function(t,i,s){t.y0=i,t.y_new=s})},Rubix.prototype._setupAxis=function(t){switch(this.axis.x.type){case"linear":this.x=d3.scale.linear(),this.x.tickFormat(d3.format(this.axis.x.tickFormat));var i=[0,this.width],s=[0,this.width];this.master_detail&&(this.x2=d3.scale.linear()),"round"===this.axis.x.range?(this.x.rangeRound(i),this.master_detail&&this.x2.rangeRound(s)):(this.x.range(i),this.master_detail&&this.x2.range(s));break;case"ordinal":this.x=d3.scale.ordinal(),this.x.invert=d3_scale_ordinal_invert.bind(this.x);var i=[0,this.width],s=[0,this.width];if(this.master_detail)throw this.canvas.select(".noData").text("Master-Detail chart only for quantitative scales."),new Error("Master-Detail chart only for quantitative scales.");"round"===this.axis.x.range?this.x.rangeRoundBands(i):"column"==this.axis.x.range||"bar"==this.axis.x.range?this.x.rangeRoundBands(i,.35):(this.x.rangePoints(i),this.master_detail&&this.x2.rangePoints(i));break;case"datetime":this.x=d3.time.scale(),this.x.ticks(d3.time.year,50),this.x.tickFormat(d3.format(this.axis.x.tickFormat));var i=[0,this.width],s=[0,this.width];this.master_detail&&(this.x2=d3.time.scale()),"round"===this.axis.x.range?(this.x.rangeRound(i),this.master_detail&&this.x2.rangeRound(s)):(this.x.range(i),this.master_detail&&this.x2.range(s));break;default:throw new Error("Unknown Scale for X Axis: "+this.axis.x.type)}switch(this.axis.y.type){case"linear":this.y=d3.scale.linear(),this.y.clamp(!0),this.y.tickFormat(d3.format(this.axis.y.tickFormat));var i=[this.height,0],s=[this.master_detail_height,0];this.master_detail&&(this.y2=d3.scale.linear(),this.y2.clamp(!0)),"round"===this.axis.y.range?(this.y.rangeRound(i),this.master_detail&&this.y2.rangeRound(s)):(this.y.range(i),this.master_detail&&this.y2.range(s));break;case"ordinal":this.y=d3.scale.ordinal(),this.y.invert=d3_scale_ordinal_invert.bind(this.y);var i=[this.height,0],s=[this.master_detail_height,0];this.master_detail&&(this.y2=d3.scale.ordinal(),this.y2.invert=d3_scale_ordinal_invert.bind(this.y2)),"round"===this.axis.y.range?(this.y.rangeRoundBands(i),this.master_detail&&this.y2.rangeRoundBands(s)):"column"==this.axis.y.range||"bar"==this.axis.y.range?this.y.rangeRoundBands(i,.35):(this.y.rangePoints(i),this.master_detail&&this.y2.rangePoints(s));break;case"datetime":this.y=d3.time.scale(),this.y.tickFormat(d3.format(this.axis.y.tickFormat)),this.y.clamp(!0);var i=[this.height,0],s=[this.master_detail_height,0];this.master_detail&&(this.y2=d3.time.scale(),this.y2.clamp(!0)),"round"===this.axis.y.range?(this.y.rangeRound(i),this.master_detail&&this.y2.rangeRound(s)):(this.y.range(i),this.master_detail&&this.y2.range(s));break;default:throw new Error("Unknown Scale for X Axis: "+this.axis.y.type)}this.fontSize=10;var e=Math.floor(this.height/(this.fontSize+3)/2);if(this.xAxis=d3.svg.axis(),this.xAxis.scale(this.x).orient("bottom"),this.master_detail&&(this.xAxis2=d3.svg.axis(),this.xAxis2.scale(this.x2).orient("bottom")),"round"!==this.axis.x.range||"linear"!==this.axis.x.type&&"datetime"!==this.axis.x.type||("linear"===this.axis.x.type?this.xAxis.tickFormat(d3.format(this.axis.x.tickFormat)):"datetime"===this.axis.x.type&&this.xAxis.tickFormat(d3.time.format(this.axis.x.tickFormat)),this.master_detail&&("linear"===this.axis.x.type?this.xAxis2.tickFormat(d3.format(this.axis.x.tickFormat)):this.xAxis2.tickFormat(d3.time.format(this.axis.x.tickFormat)))),this.axis.x.tickFormat&&("linear"===this.axis.x.type?this.xAxis.tickFormat(d3.format(this.axis.x.tickFormat)):"datetime"===this.axis.x.type&&this.xAxis.tickFormat(d3.time.format(this.axis.x.tickFormat)),this.master_detail&&("linear"===this.axis.x.type?this.xAxis2.tickFormat(d3.format(this.axis.x.tickFormat)):this.xAxis2.tickFormat(d3.time.format(this.axis.x.tickFormat)))),this.xGrid=d3.svg.axis(),this.xGrid.scale(this.x).orient("bottom").ticks(5).tickSize(-this.height,0,0).tickFormat(""),void 0!==this.axis.x.tickCount&&this.xGrid.ticks(this.axis.x.tickCount),this.master_detail&&(this.xGrid2=d3.svg.axis(),this.xGrid2.scale(this.x2).orient("bottom").ticks(5).tickSize(-this.master_detail_height,0,0).tickFormat("")),this.yAxis=d3.svg.axis(),this.yAxis.scale(this.y).orient("left"),this.yAxis.ticks(e),"round"!==this.axis.y.range||"linear"!==this.axis.y.type&&"datetime"!==this.axis.y.type||("linear"===this.axis.y.type?this.yAxis.tickFormat(d3.format(this.axis.y.tickFormat)):"datetime"===this.axis.y.type&&this.yAxis.tickFormat(d3.time.format(this.axis.y.tickFormat))),this.axis.y.tickFormat&&("linear"===this.axis.y.type?this.yAxis.tickFormat(d3.format(this.axis.y.tickFormat)):"datetime"===this.axis.y.type&&this.yAxis.tickFormat(d3.time.format(this.axis.y.tickFormat))),this.yGrid=d3.svg.axis(),this.yGrid.scale(this.y).orient("left").ticks(5).tickSize(-this.width,0,0).tickFormat(""),void 0!==this.axis.y.tickCount&&this.yGrid.ticks(this.axis.y.tickCount),this.xAxisGroup=this.axis_group.append("g"),this.xAxisGroup.attr("class","x axis"),this.xAxisGroup.attr("transform","translate(0, "+this.height+")"),this.xAxisGroup.call(this.xAxis),this.xAxisGroup.select("path").style("fill","none").style("stroke",this.opts.theme_style_color).style("shape-rendering","crispEdges"),this.xAxisGroup.selectAll("line").attr("fill","none").attr("stroke",this.opts.theme_style_color).style("shape-rendering","crispEdges"),this.master_detail&&(this.xAxisGroup2=this.md_root.append("g"),this.xAxisGroup2.attr("class","x axis"),this.xAxisGroup2.call(this.xAxis2),this.xAxisGroup2.select("path").style("fill","none"),this.xAxisGroup2.select("line").style("fill","none").style("stroke",this.opts.theme_style_color).style("shape-rendering","crispEdges"),this.xAxisGroup2.selectAll("line").attr("fill","none").attr("stroke",this.opts.theme_style_color).style("shape-rendering","crispEdges")),this.yAxisGroup=this.axis_group.append("g"),this.yAxisGroup.attr("class","y axis"),this.yAxisGroup.call(this.yAxis),this.yAxisGroup.select("path").style("fill","none").style("stroke",this.opts.theme_style_color).style("shape-rendering","crispEdges"),this.yAxisGroup.selectAll("line").attr("fill","none").attr("stroke",this.opts.theme_style_color).style("shape-rendering","crispEdges"),this.opts.draw.grid&&(this.xGridGroup=this.grid_group.append("g"),this.xGridGroup.attr("class","x grid"),this.xGridGroup.attr("transform","translate(0,"+this.height+")"),this.xGridGroup.call(this.xGrid),this.xGridGroup.selectAll("path").style("stroke-width",0),this.xGridGroup.selectAll(".tick").style("stroke",this.opts.theme_style_color).style("opacity",.7)),this.master_detail&&(this.xGridGroup2=this.md_root.select(".md-grid").append("g"),this.xGridGroup2.attr("class","x grid"),this.xGridGroup2.attr("transform","translate(0,"+this.master_detail_height+")"),this.xGridGroup2.call(this.xGrid2),this.xGridGroup2.selectAll("path").style("stroke-width",0),this.xGridGroup2.selectAll(".tick").style("stroke","lightgray").style("opacity",.7)),this.opts.draw.grid&&(this.yGridGroup=this.grid_group.append("g"),this.yGridGroup.attr("class","y grid"),this.yGridGroup.call(this.yGrid),this.yGridGroup.selectAll("path").style("stroke-width",0),this.yGridGroup.selectAll(".tick").style("stroke",this.opts.theme_style_color).style("opacity",.7)),this.resetAxis(t),this.master_detail){if("ordinal"===this.axis.x.type)throw this.canvas.select(".noData").text("Master-Detail chart only for quantitative scales."),new Error("Master-Detail chart only for quantitative scales.");this.brush=d3.svg.brush(),this.brush.x(this.x2);var a=this;"datetime"===this.axis.x.type?this.brush.on("brushend",function(){if(a.is_touch_device)t=d3.touches(this,a.d3_eventSource().changedTouches)[0];else var t=d3.mouse(this);var i=t[0];if(a.brush.empty()){var s=a.x2(+new Date(a.extent[0])),e=a.x2(+new Date(a.extent[1])),r=s-i,o=[];if(r<0){var h=s+Math.abs(r),n=e+Math.abs(r),l=a.x2(+new Date(a.x2.domain()[1]));if(n>l)h-=n-l,n=l,o=[a.x2.invert(h),a.x2.invert(n)];else{var d=Math.abs(h-n);o=[a.x2.invert(h-d/2),a.x2.invert(n-d/2)]}}else{var h=s-Math.abs(r),n=e-Math.abs(r),u=h-(d=Math.abs(h-n))/2,c=n-d/2,p=a.x2(+new Date(a.x2.domain()[0]));u<p&&(c+=p-u,u=p),o=[a.x2.invert(u),a.x2.invert(c)]}a.extent=o,a.brush.extent(a.extent),a.brush_path.call(a.brush),a._brush()}var x=a.brush_path.select(".extent").attr("x"),m=a.brush_path.select(".extent").attr("width"),y=a.brush_path.select(".extent").attr("height");a.brush_path.select(".left-extent").attr("height",y).attr("width",x).attr("x",0);var f=parseFloat(x)+parseFloat(m);a.brush_path.select(".right-extent").attr("height",y).attr("x",f).attr("width",a.md_root.attr("width")-f),a.brush_path.select(".left-border").attr("width",1).attr("x",x),a.brush_path.select(".left-top-border").attr("width",x),a.brush_path.select(".right-border").attr("width",1).attr("x",f),a.brush_path.select(".right-top-border").attr("x",f).attr("width",a.md_root.attr("width")-f),a.brush_path.select(".bottom-border").attr("x",x).attr("width",m).attr("transform","translate(0, "+(a.master_detail_height+5)+")")}):this.brush.on("brushend",function(){if(a.is_touch_device)t=d3.touches(this,a.d3_eventSource().changedTouches)[0];else var t=d3.mouse(this);var i=a.x2.invert(t[0]);if(a.brush.empty()){var s=a.extent[0],e=a.extent[1],r=s-i,o=[];if(r<0){var h=s+Math.abs(r),n=e+Math.abs(r),l=a.x2.domain()[1];o=n>l?[h-=n-l,n=l]:[h-(d=Math.abs(h-n))/2,n-d/2]}else{var h=s-Math.abs(r),n=e-Math.abs(r),d=Math.abs(h-n),u=h-d/2,c=n-d/2,p=a.x2.domain()[0];u<p&&(c+=p-u,u=p),o=[u,c]}a.extent=o,a.brush.extent(a.extent),a.brush_path.call(a.brush),a._brush()}var x=a.brush_path.select(".extent").attr("x"),m=a.brush_path.select(".extent").attr("width"),y=a.brush_path.select(".extent").attr("height");a.brush_path.select(".left-extent").attr("height",y).attr("width",x).attr("x",0);var f=parseFloat(x)+parseFloat(m);a.brush_path.select(".right-extent").attr("height",y).attr("x",f).attr("width",a.md_root.attr("width")-f),a.brush_path.select(".left-border").attr("width",1).attr("x",x),a.brush_path.select(".left-top-border").attr("width",x),a.brush_path.select(".right-border").attr("width",1).attr("x",f),a.brush_path.select(".right-top-border").attr("x",f).attr("width",a.md_root.attr("width")-f),a.brush_path.select(".bottom-border").attr("x",x).attr("width",m).attr("transform","translate(0, "+(a.master_detail_height+5)+")")}),this.brush.on("brush",function(){var t=a.d3_eventSource().type;"mousemove"!==t&&"touchmove"!==t||($(window).trigger("rubix.sidebar.off"),a._brush(!0,"root"));var i=a.brush_path.select(".extent").attr("x"),s=a.brush_path.select(".extent").attr("width"),e=a.brush_path.select(".extent").attr("height");a.brush_path.select(".left-extent").attr("height",e).attr("width",i).attr("x",0);var r=parseFloat(i)+parseFloat(s);a.brush_path.select(".right-extent").attr("height",e).attr("x",r).attr("width",a.md_root.attr("width")-r),a.brush_path.select(".left-border").attr("width",1).attr("x",i),a.brush_path.select(".left-top-border").attr("width",i),a.brush_path.select(".right-border").attr("width",1).attr("x",r),a.brush_path.select(".right-top-border").attr("x",r).attr("width",a.md_root.attr("width")-r),a.brush_path.select(".bottom-border").attr("x",i).attr("width",s).attr("transform","translate(0, "+(a.master_detail_height+5)+")")}),this.extent.length&&(this.brush.extent(this.extent),this.extent_coordinates.length||("datetime"===this.axis.x.type||"datetime"===this.axis.y.type?this.extent_coordinates=[this.x2(+new Date(this.extent[0])),this.x2(+new Date(this.extent[1]))]:this.extent_coordinates=[this.x2(this.extent[0]),this.x2(this.extent[1])]),this._brush())}},Rubix.prototype._setupSeries=function(){this.grid_group=this.root.append("g").attr("class","grid_group"),this.axis_group=this.root.append("g").attr("class","axis_group"),this.opts.hideGrid&&this.grid_group.style("display","none"),this.opts.hideAxisAndGrid&&(this.grid_group.style("display","none"),this.axis_group.style("display","none")),this.root_cb_series=this.root.append("g").attr("class","cb_series"),this.root_stacked_area_series=this.root.append("g").attr("class","stacked_area_series"),this.root_area_series=this.root.append("g").attr("class","area_series"),this.root_line_series=this.root.append("g").attr("class","line_series"),this.focus_line_group=this.root.append("g").attr("class","focus_line_group"),this.symbols_group=this.root.append("g").attr("class","symbols"),this.focus_group=this.root.append("g").attr("class","focus_group"),this.master_detail&&(this.md_root_stacked_area_series=this.md_layers.append("g").attr("class","md_stacked_area_series"),this.md_root_area_series=this.md_layers.append("g").attr("class","md_area_series"),this.md_root_line_series=this.md_layers.append("g").attr("class","md_line_series"))},Rubix.prototype.resetExtent=function(){if(this.brush.extent().length){var t=this.extent_coordinates[0],i=this.extent_coordinates[1];"datetime"===this.axis.x.type||"datetime"===this.axis.y.type?this.extent=[this.x2.invert(+new Date(t)),this.x2.invert(+new Date(i))]:this.extent=[this.x2.invert(t),this.x2.invert(i)],this.brush.extent(this.extent),this._brush_nochange()}},Rubix.prototype._brush_nochange=function(){try{this.x.domain(this.extent),this.callAxis();for(var t in this.charts)this.charts[t].noRedraw(this)}catch(t){}},Rubix.prototype._brush=function(t,i){var s=this.brush.empty()?this.x2.domain():this.brush.extent();"datetime"===this.axis.x.type||"datetime"===this.axis.y.type?(this.extent=s,t&&"root"===i&&(this.extent_coordinates=[this.x2(+new Date(this.extent[0])),this.x2(+new Date(this.extent[1]))])):(this.extent=s,t&&"root"===i&&(this.extent_coordinates=[this.x2(this.extent[0]),this.x2(this.extent[1])])),this._brush_nochange()},Rubix.prototype._setupOrdinalAxis=function(t){var i,s={},e={},a=[],r=[];this.crosshair_data=[],_o_data=[];var o={},h={};if("ordinal"===this.axis.x.type||"ordinal"===this.axis.y.type){for(var n in this.data){i=this.data[n];for(var l=this.charts[n],d=0;d<i.length;d++){var u=i[d].x,c=0;if(this.stacked){if(i[d].hasOwnProperty("y0"))c=i[d].y0;if(i[d].hasOwnProperty("y_new"))if(this.grouped&&"column_series"===l.type)p=i[d].y_new;else p=i[d].y_new+c;else p=i[d].y}else var p=i[d].y;r.push(p),s.hasOwnProperty(u)||(s[u]=[]),s[u].push(p),t&&(e.hasOwnProperty(p)||(e[p]=[]),e[p].push(u)),o.hasOwnProperty(u)||(o[u]={}),o[u][n]=p,h.hasOwnProperty(u)||(h[u]={}),h[u][n]={y0:c}}}for(var x in s)a.push(x);if(t)for(var x in e)_o_data.push(x);if(this.stacked)var m=d3.min(r,function(t){return isNaN(t)?0:t}),y=[m=m<0?m:0,d3.max(r,function(t){return isNaN(t)?0:t})];else y=d3.extent(r);var f=y[0],b=y[1];if(this.opts.invertAxes){if(this.axis.y.tickFormat.length){for(d=0;d<a.length;d++)a[d]=+a[d];a.sort(function(t,i){return t>i?1:t===i?0:-1})}if(t){if(this.axis.x.tickFormat.length){for(d=0;d<_o_data.length;d++)_o_data[d]=+_o_data[d];_o_data.sort(function(t,i){return t>i?1:t===i?0:-1})}this.x.domain(_o_data),this.y.domain(a.reverse()),this.master_detail&&(this.x2.domain(_o_data),this.y2.domain(a))}else this.x.domain([f,b]),this.y.domain(a.reverse()),this.master_detail&&(this.x2.domain([f,b]),this.y2.domain(a))}else{if(this.axis.x.tickFormat.length){for(d=0;d<a.length;d++)a[d]=+a[d];a.sort(function(t,i){return t>i?1:t===i?0:-1})}if(t){if(this.axis.y.tickFormat.length){for(d=0;d<_o_data.length;d++)_o_data[d]=+_o_data[d];_o_data.sort(function(t,i){return t>i?1:t===i?0:-1})}this.x.domain(a),this.y.domain(_o_data),this.master_detail&&(this.x2.domain(a),this.y2.domain(_o_data))}else this.x.domain(a),this.y.domain([f,b]),this.master_detail&&(this.x2.domain(a),this.y2.domain([f,b]))}for(var u in o)if(this.opts.invertAxes){_=this.y(u);this.crosshair_data.push({x:+_,y:o[u],others:h[u]})}else{var _=this.x(u);this.crosshair_data.push({x:+_,y:o[u],others:h[u]})}this.crosshair_data.sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1})}},Rubix.prototype._setupLinearAxis=function(){var t,i,s,e=null,a=null,r=null,o=null;this.crosshair_data=[];var h={},n={};for(var l in this.data){if(t=this.data[l],i=d3.extent(t,function(t){return t.x}),this.stacked){var d=d3.min(t,function(t){var i=t.y0+t.y_new;return isNaN(i)?t.y?t.y:0:i});s=[d=d<0?d:0,d3.max(t,function(t){var i=t.y0+t.y_new;return isNaN(i)?t.y?t.y:0:i})]}else s=d3.extent(t,function(t){return t.y});null===e?(e=i[0],a=i[1]):(e>=i[0]&&(e=i[0]),a<=i[1]&&(a=i[1])),null===r?(r=s[0],o=s[1]):(r>=s[0]&&(r=s[0]),o<=s[1]&&(o=s[1]));for(var u=0;u<t.length;u++){var c=t[u].x,p=0;if(this.stacked){if(t[u].hasOwnProperty("y0"))p=t[u].y0;if(t[u].hasOwnProperty("y_new"))x=t[u].y_new+p;else x=t[u].y}else var x=t[u].y;h.hasOwnProperty(c)||(h[c]={}),h[c][l]=x,n.hasOwnProperty(c)||(n[c]={}),n[c][l]={y0:p}}}this.opts.invertAxes?(this.x.domain([r,o]),this.y.domain([a,e]),this.master_detail&&(this.x2.domain([r,o]),this.y2.domain([a,e]))):(this.x.domain([e,a]),this.y.domain([r,o]),this.master_detail&&(this.x2.domain([e,a]),this.y2.domain([r,o])));for(var c in h)this.crosshair_data.push({x:+c,y:h[c],others:n[c]});this.crosshair_data.sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1})},Rubix.prototype.resetAxis=function(t){try{"linear"===this.axis.x.type&&"linear"===this.axis.y.type?this._setupLinearAxis():"datetime"===this.axis.x.type&&"linear"===this.axis.y.type||"linear"===this.axis.x.type&&"datetime"===this.axis.y.type?this._setupLinearAxis():"ordinal"===this.axis.x.type&&"ordinal"===this.axis.y.type?this._setupOrdinalAxis(!0):"ordinal"!==this.axis.x.type&&"ordinal"!==this.axis.y.type||this._setupOrdinalAxis(),this.callAxis(t)}catch(t){}},Rubix.prototype.callAxis=function(t){if(t){i=this.root.transition().duration(this.animationSpeed);if(this.master_detail)s=this.md_root.transition().duration(this.animationSpeed)}else{var i=this.root;if(this.master_detail)var s=this.md_root}if(this.hasData){if("ordinal"===this.axis.x.type){h=this.x.domain();if(void 0!==this.axis.x.tickCount&&h.length>this.axis.x.tickCount){for(var e=this,a=d3.range(h.length).map(function(t){return t%e.axis.x.tickCount==0?h[t]:null}),r=[],o=0;o<a.length;o++)null!==a[o]&&r.push(a[o]);this.xAxis.tickValues(r)}}else void 0!==this.axis.x.tickCount&&(this.xAxis.ticks(this.axis.x.tickCount),this.master_detail&&this.xAxis2.ticks(this.axis.x.tickCount));if("ordinal"===this.axis.y.type||"linear"===this.axis.x.type||"datetime"===this.axis.x.type){var h=this.y.domain();if(void 0!==this.axis.y.tickCount&&h.length>this.axis.y.tickCount){var e=this,a=d3.range(h.length).map(function(t){return t%e.axis.y.tickCount==0?h[t]:""});this.yAxis.tickValues(a)}}else void 0!==this.axis.y.tickCount&&this.yAxis.ticks(this.axis.y.tickCount);this.canvas.select(".noData").style("display","none");try{i.selectAll(".x.axis").style("display",null).call(this.xAxis),i.selectAll(".y.axis").style("display",null).call(this.yAxis),i.selectAll(".x.grid").style("display",null).call(this.xGrid),i.selectAll(".y.grid").style("display",null).call(this.yGrid)}catch(t){}this.xAxisGroup.selectAll("line").attr("fill","none").attr("stroke",this.opts.theme_style_color).style("shape-rendering","crispEdges"),this.yAxisGroup.selectAll("line").attr("fill","none").attr("stroke",this.opts.theme_style_color).style("shape-rendering","crispEdges"),this.opts.draw.grid&&(this.xGridGroup.selectAll("path").style("stroke-width",0),this.xGridGroup.selectAll(".tick").style("stroke",this.opts.theme_style_color).style("opacity",.7),this.yGridGroup.selectAll("path").style("stroke-width",0),this.yGridGroup.selectAll(".tick").style("stroke",this.opts.theme_style_color).style("opacity",.7)),this.xAxisGroup.selectAll("text").style("font",this.fontSize+1+'px Lato, "Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif').style("direction","ltr").style("fill",this.opts.tickColor).style("color",this.opts.tickColor).style("font-style","").style("font-variant","").style("font-weight","").style("line-height",""),this.yAxisGroup.selectAll("text").style("font",this.fontSize+1+'px Lato, "Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif').style("direction","ltr").style("fill",this.opts.tickColor).style("color",this.opts.tickColor).style("font-style","").style("font-variant","").style("font-weight","").style("line-height",""),"dark"===this.opts.theme_style&&(this.xAxisGroup.selectAll("text").style("font-weight","bold"),this.yAxisGroup.selectAll("text").style("font-weight","bold"))}else this.canvas.select(".noData").style("display",null),i.selectAll(".x.axis").style("display","none"),i.selectAll(".y.axis").style("display","none"),i.selectAll(".x.grid").style("display","none"),i.selectAll(".y.grid").style("display","none");this.master_detail&&(this.hasData?(this.canvas.select(".noData").style("display","none"),s.selectAll(".x.axis").style("display",null).call(this.xAxis2),s.selectAll(".x.grid").style("display",null).call(this.xGrid2),this.xAxisGroup2&&(this.xAxisGroup2.selectAll("line").attr("fill","none").attr("stroke",this.opts.theme_style_color).style("shape-rendering","crispEdges"),this.xGridGroup2.selectAll("path").style("stroke-width",0),this.xGridGroup2.selectAll(".tick").style("stroke",this.opts.theme_style_color).style("opacity",.7),this.xAxisGroup2.selectAll("text").style("font",this.fontSize+1+'px Lato, "Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif').style("direction","ltr").style("fill",this.opts.tickColor).style("color",this.opts.tickColor).style("font-style","").style("font-variant","").style("font-weight","").style("line-height",""),"dark"===this.opts.theme_style&&this.xAxisGroup2.selectAll("text").style("font-weight","bold")),this.yAxisGroup2&&(this.yAxisGroup2.selectAll("text").style("font",this.fontSize+1+'px Lato, "Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif').style("direction","ltr").style("fill",this.opts.tickColor).style("color",this.opts.tickColor).style("font-style","").style("font-variant","").style("font-weight","").style("line-height",""),"dark"===this.opts.theme_style&&this.yAxisGroup.selectAll("text").style("font-weight","bold"))):(this.canvas.select(".noData").style("display",null),s.selectAll(".x.axis").style("display","none"),s.selectAll(".y.axis").style("display","none"),s.selectAll(".x.grid").style("display","none"),s.selectAll(".y.grid").style("display","none"))),this.opts.hideYAxis&&this.yAxisGroup.style("display","none"),this.opts.hideXAxis&&this.xAxisGroup.style("display","none"),this.opts.hideXAxisTickLines&&this.xGridGroup.style("display","none"),this.opts.hideYAxisTickLines&&this.yGridGroup.style("display","none")},Rubix.prototype._setupRedraw=function(){var t=this;switch($(window).on("orientationchange."+this.master_id,function(){t.draw()}),$(window).on("rubix.redraw."+this.master_id,function(){t.draw()}),this.resize){case"always":$(window).on("resize.rubix."+this.master_id,function(){t.draw()});break;case"debounced":$(window).on("debouncedresize.rubix."+this.master_id,function(){t.draw()});break;case"throttled":$(window).on("throttledresize.rubix."+this.master_id,function(){t.draw()});break;default:throw new Error("Unknown resize type!")}},Rubix.prototype._draw=function(){this._cleanElement(),this._setSize(),this._setupCanvas(),this._setupRoot(),this._setupSeries(),this._setupAxis();for(var t in this.charts)this.charts[t].redraw(this)},Rubix.prototype._cleanElement=function(){this.elem.children().remove()},Rubix.prototype._setSize=function(){this.outerWidth=this.elem.width(),this.outerHeight=this.elem.height(),this.opts.hideYAxis&&(this.margin.left=0,this.margin.right=0),this.opts.hideAxisAndGrid&&(this.margin.left=0,this.margin.right=0),this.width=this.outerWidth-this.margin.left-this.margin.right,this.height=this.outerHeight-this.margin.top-this.margin.bottom},Rubix.prototype._setupCanvas=function(){this.elem.html(""),this.canvas=d3.select(this.elem.get(0)).append("svg"),this.canvas.attr("width",this.outerWidth),this.canvas.attr("height",this.outerHeight),this.canvas.append("desc").text("Powered by Rubix"),this.defs=this.canvas.append("defs"),this.defs.append("clipPath").attr("id",this.master_id+"-clip").append("rect").attr("width",this.width).attr("height",this.height+20).attr("transform","translate(0, -20)")},Rubix.prototype._setupRoot=function(){if(this.root=this.canvas.append("g"),this.root.attr("width",this.width),this.root.attr("height",this.height),this.opts.hideAxisAndGrid?this.root.attr("transform","translate(0,"+this.margin.top+")"):this.root.attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.hasData?this.canvas.select(".noData").style("display","none"):this.canvas.append("text").attr("class","noData").attr("font-size","30px").attr("text-anchor","middle").attr("transform","translate("+this.outerWidth/2+","+this.outerHeight/2+")").attr("font-family",'Lato, "Lucida Grande", Arial, Helvetica, sans-serif').text("No Data"),this.master_detail){this.md_root=this.canvas.append("g"),this.md_root.attr("width",this.width),this.md_root.attr("height",this.master_detail_height),this.opts.hideAxisAndGrid||this.md_root.attr("transform","translate("+this.margin.left+","+(this.margin.top+this.height+this.master_detail_margin_bottom)+")");var t=this.md_root.append("rect");t.attr("width",this.md_root.attr("width")),t.attr("height",this.md_root.attr("height")),t.attr("fill","none"),t.attr("shape-rendering","crispEdges"),this.md_root.append("g").attr("class","md-grid").attr("width",this.md_root.attr("width")),this.md_layers=this.md_root.append("g").attr("class","md-layers").attr("clip-path","url(#"+this.master_id+"-clip)"),this.defs.append("clipPath").attr("id",this.master_id+"-clip-symbols").append("rect").attr("width",this.md_root.attr("width")).attr("height",this.height+20).attr("transform","translate(0, -10)"),this.defs.append("clipPath").attr("id",this.master_id+"-clip-brush").append("rect").attr("width",this.md_root.attr("width")+20).attr("height",this.master_detail_height).attr("transform","translate(-10, 1)")}},Rubix.prototype.marginLeft=function(t){if(!arguments.length)return this.margin.left;10+t+10<this.margin.defaultLeft?this.margin.left=this.margin.defaultLeft:this.margin.left=10+t+10,this.axis.x.label.length&&this.opts.invertAxes&&(this.margin.left+=15),this.axis.y.label.length&&(this.opts.invertAxes||(this.margin.left+=15)),this.draw()},Rubix.prototype.forceRedraw=function(){try{this.hasData=!1;for(var t in this.charts)this.hasData=!0,this.charts[t].forceRedraw(this);this.hasData?(this.canvas.select(".noData").style("display","none"),this.root.selectAll(".axis").style("display",null)):(this.canvas.select(".noData").style("display",null),this.root.selectAll(".axis").style("display","none"))}catch(t){}},Rubix.prototype.resizePath=function(t){var i=+("e"==t),s=i?1:-1,e=this.master_detail_height/2;return"M"+.5*s+","+e+"A6,6 0 0 "+i+" "+6.5*s+","+(e+6)+"V"+(2*e-6)+"A6,6 0 0 "+i+" "+.5*s+","+2*e+"ZM"+2.5*s+","+(e+8)+"V"+(2*e-8)+"M"+4.5*s+","+(e+8)+"V"+(2*e-8)},Rubix.prototype._createBrushPath=function(){var t=this;this.brush_path&&this.brush_path.remove(),this.brush_path=this.md_root.append("g"),this.brush_path.attr("height",this.master_detail_height+5),this.brush_path.attr("width",this.md_root.attr("width")),this.brush_path.attr("class","x brush"),this.brush_path.attr("transform","translate(0, -4)"),this.brush_path.call(this.brush);var i="rgb(16, 16, 16)";"light"===this.opts.theme_style&&(i="white"),this.brush_path.selectAll(".extent").attr("stroke","none").attr("fill-opacity",0).attr("shape-rendering","crispEdges"),this.brush_path.insert("rect",".resize").attr("class","left-extent").attr("fill-opacity",.5).attr("fill",i).style("cursor","crosshair"),this.brush_path.insert("rect",".resize").attr("class","right-extent").attr("fill-opacity",.5).attr("fill",i).style("cursor","crosshair"),this.brush_path.insert("rect",".resize").attr("class","left-border").attr("x",0).style("fill",this.opts.theme_style_color),this.brush_path.insert("rect",".resize").attr("class","left-top-border").attr("x",0).style("fill",this.opts.theme_style_color),this.brush_path.insert("rect",".resize").attr("class","right-border").style("fill",this.opts.theme_style_color),this.brush_path.insert("rect",".resize").attr("class","right-top-border").style("fill",this.opts.theme_style_color),this.brush_path.insert("rect",".resize").attr("class","bottom-border").style("fill","rgb(16, 16, 16)").attr("fill-opacity",.3);var s=this.brush_path.select(".extent").attr("x"),e=this.brush_path.select(".extent").attr("width"),a=this.brush_path.select(".extent").attr("height");this.brush_path.select(".left-extent").attr("height",a).attr("width",s).attr("x",0);var r=parseFloat(s)+parseFloat(e);this.brush_path.select(".right-extent").attr("height",a).attr("x",r).attr("width",this.md_root.attr("width")-r),this.brush_path.select(".left-border").attr("width",1).attr("x",s),this.brush_path.select(".left-top-border").attr("width",s),this.brush_path.select(".right-border").attr("width",1).attr("x",r),this.brush_path.select(".right-top-border").attr("x",r).attr("width",this.md_root.attr("width")-r),this.brush_path.select(".bottom-border").attr("x",s).attr("width",e).attr("transform","translate(0, "+(this.master_detail_height+5)+")"),this.brush_path.selectAll(".resize").append("path").attr("d",function(i){return t.resizePath(i)}).style("fill","#EEE").style("stroke","#666").attr("transform","translate(0, -"+this.master_detail_height/5+")"),this.brush_path.selectAll("rect").attr("height",this.master_detail_height+5),this.brush_path.select(".left-top-border").attr("height",1),this.brush_path.select(".right-top-border").attr("height",1),this.brush_path.select(".bottom-border").attr("height",1),this.extent.length||(this.extent=this.x2.domain(),this.brush.extent(this.extent),this._brush())},Rubix.prototype.bisectLeft=d3.bisector(function(t){return t.x}).left,Rubix.prototype.bisectRight=d3.bisector(function(t){return t.x}).right,Rubix.prototype.move_tooltip_x=function(t,i,s){var e;i.length&&(e=d3.mean(i)/i.length);var a=t;"column"!==this.axis.x.range&&"bar"!==this.axis.x.range||(t+=this.x.rangeBand()/2);var r=this.root_elem,o=(this.tooltip.outerWidth()-this.tooltip.width())/2,h=t+this.margin.left+o,n=e,l=r.width(),d=h+this.tooltip.outerWidth();"column"!==this.axis.x.range&&"bar"!==this.axis.x.range||(t=a-this.x.rangeBand()/2),d>l&&(h-=d-t-this.margin.left+o),this.tooltip.css("display","inline"),this.tooltip.css("display",useTable),this.tooltip.css({left:h,top:n});var u,c,p="";u=this.tooltipFormatter.format.x.length?"datetime"===this.axis.x.type?d3.time.format(this.tooltipFormatter.format.x):d3.format(this.tooltipFormatter.format.x):function(t){return t},c=this.tooltipFormatter.format.y.length?"datetime"===this.axis.y.type?d3.time.format(this.tooltipFormatter.format.y):d3.format(this.tooltipFormatter.format.y):function(t){return t};for(var x in s){var m,y;m=u("datetime"===this.axis.x.type?new Date(s[x].x):s[x].invert?this.x.invert(s[x].x):s[x].x),y="datetime"===this.axis.y.type?null!==s[x].y?c(new Date(s[x].y)):null:s[x].invert?null!==s[x].y?c(this.y.invert(s[x].y)):null:c(s[x].y),m=this.tooltipFormatter.abs.x?Math.abs(m):m,y=this.tooltipFormatter.abs.y?Math.abs(y):y,p="<div style='color: "+s[x].opts.color+"; margin-bottom: 2px; line-height: 22px;'><b style='position:relative; top: -5px; left: -2px;'><span style='font-size: 22px;'>■ </span><span style='position:relative; top: -3px; left: -2px;'>"+x+"</span></b></div>"+("<div style='font-size: 10px; margin-top: -10px;'>x : "+m+" </div>")+("<div style='font-size: 10px; margin-top: -5px;'>y : "+y+" </div><br>")+p}p=p.slice(0,p.length-4),this.tooltip.html(p),this.tooltip.outerHeight()+e>=r.height()&&(n=this.margin.top,this.tooltip.css("top",n))},Rubix.prototype.move_tooltip_y=function(t,i,s){try{var e;i.length&&(e=d3.max(i));var a=e;"column"!==this.axis.x.range&&"bar"!==this.axis.x.range||(e+=this.y.rangeBand()/2);var r=$(this.canvas.node()),o=(this.tooltip.outerWidth()-this.tooltip.width())/2,h=e+this.margin.left+o,n=t,l=r.width(),d=h+this.tooltip.outerWidth();"column"!==this.axis.x.range&&"bar"!==this.axis.x.range||(e=a-this.y.rangeBand()/2),d>l&&(h-=d-e-this.margin.left+o);var u=r.height(),c=n+this.tooltip.outerHeight()+this.margin.bottom;c>u&&(n-=c-u),this.tooltip.css("display","inline"),this.tooltip.css("display",useTable),this.tooltip.css({left:h,top:n});var p,x,m="";p=this.tooltipFormatter.format.x.length?"datetime"===this.axis.x.type?d3.time.format(this.tooltipFormatter.format.x):d3.format(this.tooltipFormatter.format.x):function(t){return t},x=this.tooltipFormatter.format.y.length?"datetime"===this.axis.y.type?d3.time.format(this.tooltipFormatter.format.y):d3.format(this.tooltipFormatter.format.y):function(t){return t};for(var y in s){var f,b;f=x("datetime"===this.axis.y.type?new Date(s[y].y):s[y].invert?this.y.invert(s[y].y):s[y].y),b=p("datetime"===this.axis.x.type?new Date(s[y].x):s[y].invert?this.x.invert(s[y].x):s[y].x),f=this.tooltipFormatter.abs.x?Math.abs(f):f,b=this.tooltipFormatter.abs.y?Math.abs(b):b,m="<div style='color: "+s[y].opts.color+"; margin-bottom: 2px'><b style='position:relative; top: -5px; left: -2px;'><span style='font-size: 22px;'>■ </span><span style='position:relative; top: -3px; left: -2px;'>"+y+"</span></b></div>"+("<div style='font-size: 10px; margin-top: -10px;'>x : "+f+" </div>")+("<div style='font-size: 10px; margin-top: -5px;'>y : "+b+" </div><br>")+m}m=m.slice(0,m.length-4),this.tooltip.html(m)}catch(t){}},Rubix.prototype.overlayX=function(t,i){i[1];try{if("ordinal"===t.axis.x.type){s=i[0];"column"!==t.axis.x.range&&"bar"!==t.axis.x.range||(s-=t.x.rangeBand()/2);e=t.bisectLeft(t.crosshair_data,s,1)}else var s=t.x.invert(i[0]+1),e=t.bisectLeft(t.crosshair_data,s,1);var a,r=t.crosshair_data[e-1],o=t.crosshair_data[e],h=s-r.x>o.x-s?o:r,n=h.y,l=(h.others,[]),d={},u=[];for(var c in t.charts)try{if(n.hasOwnProperty(c)){if("ordinal"===t.axis.x.type){if(null!==n[c]&&null!==h.others[c].y0){u.push(!0);var p=h.x,x=t.y(n[c]);"column"!==t.axis.x.range&&"bar"!==t.axis.x.range||(t.grouped&&t.charts[c].hasOwnProperty("count")?p=h.x+t.x.rangeBand()/t.charts[c].layers.length*t.charts[c].count+t.x.rangeBand()/(2*t.charts[c].layers.length):p+=t.x.rangeBand()/2),t.charts[c].focus.attr("transform","translate("+p+","+x+")").style("display",null),a=("column"===t.axis.x.range||"bar"===t.axis.x.range)&&t.grouped&&t.charts[c].hasOwnProperty("count")?h.x+t.x.rangeBand()/2:p,l.push(x),d[c]={x:p,y:n[c]?x:null,opts:t.charts[c].opts,invert:!0}}}else{u.push(!0);var p=t.x(h.x),x=t.y(n[c]);t.charts[c].focus.attr("transform","translate("+p+","+x+")").style("display",null),a=p,l.push(x),d[c]={x:h.x,y:n[c],opts:t.charts[c].opts,invert:!1}}u.length&&t.charts[c].on_focus(p,x)}else t.charts[c].focus.style("display","none"),t.charts[c].off_focus()}catch(t){}if(u.length){if("ordinal"===t.axis.x.type){p=h.x;"column"!==t.axis.x.range&&"bar"!==t.axis.x.range||(p+=t.x.rangeBand()/2),t.focusLine.style("display",null).attr("transform","translate("+p+",0)")}else t.focusLine.style("display",null).attr("transform","translate("+t.x(h.x)+",0)");t.move_tooltip_x(a,l,d)}}catch(t){}},Rubix.prototype.overlayY=function(t,i){i[0];var s=i[1];try{"ordinal"===t.axis.y.type?"column"!==t.axis.y.range&&"bar"!==t.axis.y.range||(s-=t.y.rangeBand()/2):s=t.y.invert(s);var e,a=t.bisectRight(t.crosshair_data,s,1),r=t.crosshair_data[a-1],o=t.crosshair_data[a],h=s-r.x>o.x-s?o:r,n=h.y,l=(h.others,[]),d={},u=[];for(var c in t.charts)try{if(n.hasOwnProperty(c)){if("ordinal"===t.axis.y.type){if(null!==n[c]&&null!==h.others[c].y0){u.push(!0);var p=h.x,x=t.x(n[c]);"column"!==t.axis.y.range&&"bar"!==t.axis.y.range||(t.grouped&&t.charts[c].hasOwnProperty("count")?p=h.x+t.y.rangeBand()/t.charts[c].layers.length*t.charts[c].count+t.y.rangeBand()/(2*t.charts[c].layers.length):p+=t.y.rangeBand()/2),t.charts[c].focus.attr("transform","translate("+x+","+p+")").style("display",null),e=p,l.push(x),d[c]={x:x,y:p,opts:t.charts[c].opts,invert:!0}}}else{u.push(!0);var p=t.y(h.x),x=t.x(n[c]);t.charts[c].focus.attr("transform","translate("+x+","+p+")").style("display",null),e=p,l.push(x),d[c]={x:n[c],y:h.x,opts:t.charts[c].opts,invert:!1}}u.length&&t.charts[c].on_focus(x,p)}else t.charts[c].focus.style("display","none"),t.charts[c].off_focus()}catch(t){}if(u.length){if("ordinal"===t.axis.y.type){p=h.x;"column"!==t.axis.y.range&&"bar"!==t.axis.y.range||(p+=t.y.rangeBand()/2),t.focusLine.style("display",null).attr("transform","translate(0,"+p+")")}else t.focusLine.style("display",null).attr("transform","translate(0,"+t.y(h.x)+")");t.move_tooltip_y(e,l,d)}}catch(t){}},Rubix.prototype.resetFocus=function(t){if(this.width&&this.height){this.focusLine&&this.focusLine.remove(),this.symbols&&this.symbols.remove(),this.overlay&&this.overlay.remove(),this.xlabel&&this.xlabel.remove(),this.ylabel&&this.ylabel.remove();var i=this;this.axis.x.label.length&&(this.xlabel=this.root.append("text"),this.xlabel.style("font-size","12px"),this.xlabel.style("font-weight","bold"),this.xlabel.style("font-family",'Lato, "Lucida Grande", Arial, Helvetica, sans-serif'),this.xlabel.attr("fill",this.xlabelcolor||"steelblue"),this.xlabel.attr("stroke","none"),this.xlabel.style("text-anchor","middle"),this.opts.invertAxes?(this.xlabel.attr("y",20-this.margin.left),this.xlabel.attr("x",-parseInt(this.root.attr("height"))/2),this.xlabel.attr("transform","rotate(-90)"),this.xlabel.text(this.axis.y.label)):(this.xlabel.attr("y",parseInt(this.root.attr("height"))+this.margin.bottom-15),this.xlabel.attr("x",parseInt(this.root.attr("width"))/2),this.xlabel.text(this.axis.x.label))),this.axis.y.label.length&&(this.ylabel=this.root.append("text"),this.ylabel.style("font-size","12px"),this.ylabel.style("font-weight","bold"),this.ylabel.style("font-family",'Lato, "Lucida Grande", Arial, Helvetica, sans-serif'),this.ylabel.attr("fill",this.ylabelcolor||"steelblue"),this.ylabel.attr("stroke","none"),this.ylabel.style("text-anchor","middle"),this.opts.invertAxes?(this.ylabel.attr("y",parseInt(this.root.attr("height"))+this.margin.bottom-15),this.ylabel.attr("x",parseInt(this.root.attr("width"))/2),this.ylabel.text(this.axis.x.label)):(this.ylabel.attr("y",20-this.margin.left),this.ylabel.attr("x",-parseInt(this.root.attr("height"))/2),this.ylabel.attr("transform","rotate(-90)"),this.ylabel.text(this.axis.y.label))),this.opts.invertAxes?this.focusLine=this.focus_line_group.append("line").attr("x1",0).attr("y1",0).attr("x2",this.width).attr("y2",0).attr("stroke",this.opts.theme_focus_line_color).attr("stroke-width",1).attr("shape-rendering","crispEdges").style("display","none").attr("class","focus-line"):this.focusLine=this.focus_line_group.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",this.height).attr("stroke",this.opts.theme_focus_line_color).attr("stroke-width",1).attr("shape-rendering","crispEdges").style("display","none").attr("class","focus-line"),this.symbols=this.symbols_group.append("g");for(var s in i.charts)i.charts[s].on_complete_draw();var e=[];for(var s in i.charts)e.push(s);"column"!=this.axis.x.range&&"bar"!=this.axis.x.range||e.reverse();for(var a=0;a<e.length;a++){s=e[a];i.charts[s].setupFocus()}this.master_detail&&(t||this._createBrushPath()),this.overlay=this.root.append("rect"),this.overlay.attr("class","overlay"),this.overlay.attr("width",this.width),this.overlay.attr("height",this.height),this.overlay.attr("fill","none"),this.overlay.attr("pointer-events","all"),this.overlay.attr("clip-path","url(#"+this.master_id+"-clip)");var r=function(){$(window).trigger("rubix.sidebar.off"),d3.event.preventDefault(),i.focusLine.style("display",null),$(this).focus()},o=function(){if($(window).trigger("rubix.sidebar.off"),d3.event.preventDefault(),$(this).focus(),i.hasData){if(i.is_touch_device)t=d3.touches(this)[0];else var t=d3.mouse(this);if(i.opts.invertAxes){if(t[1]<0||t[1]>i.height)return;i.overlayY.call(this,i,t)}else{if(t[0]<0||t[0]>i.width)return;i.overlayX.call(this,i,t)}}},h=function(){$(window).trigger("rubix.sidebar.on"),d3.event.preventDefault(),$(this).focus(),i.tooltip.hide();for(var t in i.charts)try{i.charts[t].focus.style("display","none"),i.charts[t].off_focus()}catch(t){}i.focusLine.style("display","none")};i.is_touch_device?window.navigator.msPointerEnabled?(this.overlay.on("MSPointerDown",r),this.overlay.on("MSPointerMove",o),this.overlay.on("MSPointerUp",h)):(this.overlay.on("touchstart",r),this.overlay.on("touchmove",o),this.overlay.on("touchend",h)):(this.overlay.on("mouseover",r),this.overlay.on("mousemove",o),this.overlay.on("mouseout",h))}},Rubix.prototype.runCommand=function(t){for(var i in this.charts)try{this.charts[i][t](this)}catch(t){}},Rubix.prototype.resetLabelHandlers=function(){var t=this;$("."+this.master_id+"-legend-labels").css({opacity:.9}),$("."+this.master_id+"-legend-labels").off().on({hover:function(t){if(!$(this).hasClass("toggle"))switch(t.type){case"mouseenter":$(this).css({opacity:1});break;case"mouseleave":$(this).css({opacity:.9})}},click:function(i){var s=$(this).hasClass("toggle"),e=$(this).attr("data-name"),a=$(this).attr("data-type")||"";if(s){$(this).css({opacity:1}),$(this).removeClass("toggle");var r=t.chart_stack[e];if(t.charts[e]=r,delete t.chart_stack[e],a.length){var o=t.column_stack_data_stack,h=t.column_stack_data;"astack"===a&&(o=t.area_stack_data_stack,h=t.area_stack_data);for(var n=0,l=0;l<o.length;l++)if(o[l]){var d=o[l].key;if(d===e){n=o[l].orderKey,p=o[l],o.splice(l,1);break}}h.splice(n,0,p)}x=t.data_stack[e];t.data[e]=x,delete t.data_stack[e],t.charts[e].show()}else{if($(this).css({opacity:.2}),$(this).addClass("toggle"),(r=t.charts[e]).hidden(),delete t.charts[e],t.chart_stack[e]=r,a.length){var u=t.column_stack_data,c=t.column_stack_data_stack;"astack"===a&&(u=t.area_stack_data,c=t.area_stack_data_stack);for(var p,n=0,l=0;l<u.length;l++)if(u[l]&&(d=u[l].key)===e){n=u[l].orderKey,p=u[l],u.splice(l,1);break}c.splice(n,0,p)}var x=t.data[e];t.data_stack[e]=x,delete t.data[e]}t.draw(),t.draw()}})},Rubix.prototype.line_series=function(t){if(t=t||{},t.name=t.name||this._generate_name(),this.charts.hasOwnProperty(t.name))throw new Error("Series exists: "+name);var i=new Rubix.LineSeries(this,t);return this.charts[i.name]=i,this.legend.append("<div class='"+this.master_id+"-legend-labels' data-name='"+i.name+"' style='cursor: pointer; display: inline-block; font-weight: bold; margin-right: 10px; color: "+i.opts.color+"'><span style='font-size: 22px;'>■ </span><span style='font-size: 12px; position:relative; top: -3px; left: -2px;'>"+i.name+"</span></div>"),this.resetLabelHandlers(),i},Rubix.prototype.area_series=function(t){if(t=t||{},t.name=t.name||this._generate_name(),this.charts.hasOwnProperty(t.name))throw new Error("Series exists: "+name);if(this.stacked){var i=new Rubix.StackedAreaSeries(this,t);return this.charts[i.name]=i,this.legend.append("<div class='"+this.master_id+"-legend-labels' data-name='"+i.name+"' data-type='astack' style='cursor: pointer; display: inline-block; font-weight: bold; margin-right: 10px; color: "+i.opts.color+"'><span style='font-size: 22px;'>■ </span><span style='font-size: 12px; position:relative; top: -3px; left: -2px;'>"+i.name+"</span></div>"),this.resetLabelHandlers(),i}var s=new Rubix.AreaSeries(this,t);return this.charts[s.name]=s,this.legend.append("<div class='"+this.master_id+"-legend-labels' data-name='"+s.name+"' style='cursor: pointer; display: inline-block; font-weight: bold; margin-right: 10px; color: "+s.opts.color+"'><span style='font-size: 22px;'>■ </span><span style='font-size: 12px; position:relative; top: -3px; left: -2px;'>"+s.name+"</span></div>"),this.resetLabelHandlers(),s},Rubix.prototype._generate_name=function(){return"Series "+ ++this.chart_counter},Rubix.prototype.column_series=function(t){if(t=t||{},t.name=t.name||this._generate_name(),this.charts.hasOwnProperty(t.name))throw new Error("Series exists: "+name);!1===this.opts.invertAxes&&"column"===this.opts.axis.x.range||(this.opts.invertAxes=!1,this.opts.axis.x.type="ordinal",this.opts.axis.x.range="column",this.setup());var i=new Rubix.ColumnSeries(this,t);return this.charts[i.name]=i,this.legend.append("<div class='"+this.master_id+"-legend-labels' data-name='"+i.name+"' data-type='cstack' style='cursor: pointer; display: inline-block; font-weight: bold; margin-right: 10px; color: "+i.opts.color+"'><span style='font-size: 22px;'>■ </span><span style='font-size: 12px; position:relative; top: -3px; left: -2px;'>"+i.name+"</span></div>"),this.resetLabelHandlers(),i},Rubix.prototype.bar_series=function(t){if(t=t||{},t.name=t.name||this._generate_name(),this.charts.hasOwnProperty(t.name))throw new Error("Series exists: "+name);!0===this.opts.invertAxes&&"column"===this.opts.axis.x.range||(this.opts.invertAxes=!0,this.opts.axis.x.type="ordinal",this.opts.axis.x.range="column",this.setup());var i=new Rubix.ColumnSeries(this,t);return this.charts[i.name]=i,this.legend.append("<div class='"+this.master_id+"-legend-labels' data-name='"+i.name+"' data-type='cstack' style='cursor: pointer; display: inline-block; font-weight: bold; margin-right: 10px; color: "+i.opts.color+"'><span style='font-size: 22px;'>■ </span><span style='font-size: 12px; position:relative; top: -3px; left: -2px;'>"+i.name+"</span></div>"),this.resetLabelHandlers(),i},window.Rubix=window.Rubix||{},Rubix.StackedAreaSeries=function(t,i){if(this.opts=i,this.opts.color=this.opts.color||"steelblue",this.opts.marker=this.opts.marker||"circle",this.opts.fillopacity=this.opts.fillopacity||.5,this.opts.strokewidth=this.opts.strokewidth||1,this.opts.noshadow=this.opts.noshadow||!1,this.show_markers=this.opts.show_markers,!this.opts.hasOwnProperty("name"))throw new Error("StackedAreaSeries should have a 'name' property");this.name=this.opts.name,this.chart_hidden=!1,this.temp_stack=[],this.setup=!1,this.last_stack=[],this.last_stack_name="",this.last_stack_added=!1,this._setup(t)},Rubix.StackedAreaSeries.prototype._setup=function(t){this.rubix=t,this.root=this.rubix.root,this.data=this.rubix.data,this.width=this.rubix.width,this.height=this.rubix.height,this.stack=this.rubix.area_stack,this.offset=this.rubix.area_offset,this.area_stack_data=this.rubix.area_stack_data,this.stacked_area_series=this.rubix.root_stacked_area_series,this.show_markers=void 0===this.show_markers?this.rubix.show_markers:this.show_markers,this.master_detail=this.rubix.master_detail,this.master_detail&&(this.md_root=this.rubix.md_root),this.id||(this.id=this.rubix.uid("stacked-area"));var i=this;this.line=d3.svg.line(),this.line.defined(function(t){return"expand"===i.rubix.offset?0!==t.y_new||1!==t.y0:null!==t.y_new&&null!==t.x}),this.rubix.opts.invertAxes?(this.line.x(function(t){var s=t.y0+t.y_new;return isNaN(s)?0:i.rubix.x(s)}),this.line.y(function(t){return"column"===i.rubix.axis.y.range||"bar"===i.rubix.axis.y.range?i.rubix.y(t.x)+i.rubix.y.rangeBand()/2:i.rubix.y(t.x)}),this.line.interpolate(this.rubix.interpolate)):(this.line.x(function(t){return"column"===i.rubix.axis.x.range||"bar"===i.rubix.axis.x.range?i.rubix.x(t.x)+i.rubix.x.rangeBand()/2:i.rubix.x(t.x)}),this.line.y(function(t){var s=t.y0+t.y_new;return isNaN(s)?0:i.rubix.y(s)}),this.line.interpolate(this.rubix.interpolate)),this.area=d3.svg.area(),this.area.defined(this.line.defined()),this.rubix.opts.invertAxes?(this.area.x0(function(t){var s=t.y0;return isNaN(s)?0:i.rubix.x(s)}),this.area.x1(function(t){var s=t.y0+t.y_new;return isNaN(s)?0:i.rubix.x(s)}),this.area.y(function(t){return"column"===i.rubix.axis.y.range||"bar"===i.rubix.axis.y.range?i.rubix.y(t.x)+i.rubix.y.rangeBand()/2:i.rubix.y(t.x)}),this.area.interpolate(this.rubix.interpolate)):(this.area.x(function(t){return"column"===i.rubix.axis.x.range||"bar"===i.rubix.axis.x.range?i.rubix.x(t.x)+i.rubix.x.rangeBand()/2:i.rubix.x(t.x)}),this.area.y0(function(t){var s=t.y0;return isNaN(s)?0:i.rubix.y(s)}),this.area.y1(function(t){var s=t.y0+t.y_new;return isNaN(s)?0:i.rubix.y(s)}),this.area.interpolate(this.rubix.interpolate)),this.master_detail&&(this.master_line=d3.svg.line(),this.master_line.defined(function(t){return"expand"===i.rubix.area_offset?0!==t.y_new||1!==t.y0:null!==t.y_new&&null!==t.x}),this.master_line.x(function(t){return i.rubix.x2(t.x)}),this.master_line.y(function(t){var s=t.y0+t.y_new;return isNaN(s)?0:i.rubix.y2(s)}),this.master_line.interpolate(this.rubix.interpolate),this.master_area=d3.svg.area(),this.master_area.defined(this.master_line.defined()),this.master_area.x(function(t){return i.rubix.x2(t.x)}),this.master_area.y0(function(t){var s=t.y0;return isNaN(s)?0:i.rubix.y2(s)}),this.master_area.y1(function(t){var s=t.y0+t.y_new;return isNaN(s)?0:i.rubix.y2(s)}),this.master_area.interpolate(this.rubix.interpolate))},Rubix.StackedAreaSeries.prototype.redraw=function(t){this._setup(t),this.draw()},Rubix.StackedAreaSeries.prototype.noRedraw=function(t){this._setup(t),this.draw(!0)},Rubix.StackedAreaSeries.prototype.addData=function(t){if(this.rubix.data_changed=!0,!(t instanceof Array)){if(!(t instanceof Object))throw new Error("Data must be an array or object");if(!t.hasOwnProperty("x")&&!t.hasOwnProperty("y"))throw new Error("Object must be in the form: {x: ..., y: ...}");t=[t]}t.length&&(this.rubix.opts.noSort||t.sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1}),this.data[this.name]=t,this.area_stack_data.push({key:this.name,color:this.opts.color,values:this.data[this.name],fillopacity:this.opts.fillopacity,strokewidth:this.opts.strokewidth,orderKey:this.area_stack_data.length}),this.rubix.resetAxis(!0),this.rubix.forceRedraw(),this._animate_draw())},Rubix.StackedAreaSeries.prototype.draw=function(t){if(this.name&&this.data&&this.data.hasOwnProperty(this.name)&&this.data[this.name].length){var i=this.layers;try{this.layers=this.stack(this.area_stack_data)}catch(t){this.layers=i}var s=this;if(this.stacked_area_series.selectAll("."+this.id)[0].length)this.rubix.runCommand("globalRedraw");else{try{this.stacked_area_series.selectAll(".layer").remove(),this.stacked_area_series.selectAll("."+this.id+"-line").remove();var e=this.stacked_area_series.selectAll(".layer").data(this.layers,function(t){return t.key}),a=e.enter().append("path");if(a.attr("class","layer").attr("d",function(t){return s.area(t.values)}).attr("fill",function(t){return t.color}).attr("fill-opacity",function(t){return t.fillopacity}).attr("stroke","none"),e.exit().remove(),this.master_detail&&(a.attr("clip-path","url(#"+s.rubix.master_id+"-clip)"),a.classed("clipped",!0),!t)){var r=this.md_root.select(".md-layers > .md_stacked_area_series").selectAll(".layer").data(this.layers,function(t){return t.key}),o=r.enter().append("path");o.attr("class","layer").attr("d",function(t){return s.master_area(t.values)}).attr("fill",function(t){return t.color}).attr("fill-opacity",function(t){return t.fillopacity}).attr("stroke","none"),o.attr("clip-path","url(#"+s.rubix.master_id+"-clip)"),o.classed("clipped",!0),r.exit().remove()}for(var h=0;h<this.layers.length;h++){var n=this.layers[h].key;if(this.name===n){var l=this.layers[h].values;this.opts.noshadow||(this.strokePath1=this.stacked_area_series.append("path").attr("class",this.id+"-line").datum(l).attr("d",this.line).attr("stroke","black").attr("fill","none").attr("stroke-linecap","round").attr("stroke-width",5*this.opts.strokewidth).attr("stroke-opacity",.05000000000000001).attr("transform","translate(1,1)"),this.strokePath2=this.stacked_area_series.append("path").attr("class",this.id+"-line").datum(l).attr("d",this.line).attr("stroke","black").attr("fill","none").attr("stroke-linecap","round").attr("stroke-width",3*this.opts.strokewidth).attr("stroke-opacity",.1).attr("transform","translate(1,1)"),this.strokePath3=this.stacked_area_series.append("path").attr("class",this.id+"-line").datum(l).attr("d",this.line).attr("stroke","black").attr("fill","none").attr("stroke-linecap","round").attr("stroke-width",1*this.opts.strokewidth).attr("stroke-opacity",.15000000000000002).attr("transform","translate(1,1)")),this.linePath=this.stacked_area_series.append("path").datum(l).attr("class",this.id+"-line").attr("stroke",this.opts.color).attr("fill","none").attr("stroke-linecap","round").attr("d",this.line).attr("stroke-width",2*this.opts.strokewidth),this.master_detail&&(t||(this.md_root.select(".md-layers > .md_stacked_area_series").selectAll("."+this.id+"-line").remove(),this.masterLinePath=this.md_root.select(".md-layers > .md_stacked_area_series").append("path").datum(l).attr("class",this.id+"-line").attr("stroke",this.opts.color).attr("fill","none").attr("stroke-linecap","round").attr("d",this.master_line).attr("stroke-width",2*this.opts.strokewidth),this.masterLinePath.attr("clip-path","url(#"+s.rubix.master_id+"-clip)"),this.masterLinePath.classed("clipped",!0),this.dataChanged&&(this.rubix.resetExtent(),this.dataChanged=!1)),this.opts.noshadow||(this.strokePath1.attr("clip-path","url(#"+s.rubix.master_id+"-clip)"),this.strokePath2.attr("clip-path","url(#"+s.rubix.master_id+"-clip)"),this.strokePath3.attr("clip-path","url(#"+s.rubix.master_id+"-clip)")),this.linePath.attr("clip-path","url(#"+s.rubix.master_id+"-clip)"),this.opts.noshadow||(this.strokePath1.classed("clipped",!0),this.strokePath2.classed("clipped",!0),this.strokePath3.classed("clipped",!0)),this.linePath.classed("clipped",!0));break}}}catch(t){}this.setup=!0}this.rubix.resetFocus(t)}},Rubix.StackedAreaSeries.prototype.updatePoint=function(t,i,s){this.addPoint(t,i,s)},Rubix.StackedAreaSeries.prototype.removePoint=function(t,i){if(this.chart_hidden)this.temp_stack.push({type:"removePoint",ref:t});else{this.data[this.name]||(this.data[this.name]=[]);for(var s=!1,e=0,a=0;a<this.data[this.name].length;a++)if(this.data[this.name][a].x===t){this.data[this.name][a].y=null,e=a,s=!0;break}if(s){for(var r=!1,a=0;a<this.area_stack_data.length;a++){var o=this.area_stack_data[a];try{if(o.values[e].x===t&&null!==o.values[e].y){r=!0;break}}catch(t){}}if(!r)for(a=0;a<this.area_stack_data.length;a++)this.area_stack_data[a].values.splice(e,1);var h=this.layers;try{this.layers=this.stack(this.area_stack_data)}catch(t){this.layers=h}this.master_detail&&(this.dataChanged=!0),i||(this.setup?this._animate_draw():(this.rubix.resetAxis(!0),this.rubix.forceRedraw()))}}},Rubix.StackedAreaSeries.prototype.addPoint=function(t,i,s){if(this.rubix.data_changed=!0,!(t instanceof Object)||t instanceof Array)throw new Error("Object required for addPoint");if(!t.hasOwnProperty("x")&&!t.hasOwnProperty("y"))throw new Error("Object must be in the form: {x: ..., y: ...}");if(this.chart_hidden)this.temp_stack.push({type:"addPoint",data:t,shift:i});else{this.data[this.name]||(this.data[this.name]=[]);for(var e=!1,a=0;a<this.data[this.name].length;a++)if(this.data[this.name][a].x===t.x){this.data[this.name][a].y=t.y,e=!0;break}e||this.data[this.name].push(t),this.data[this.name].sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1}),this.rubix.opts.interval?this.rubix.opts.interval<this.data[this.name].length&&this.data[this.name].shift():i&&this.data[this.name].shift();for(var r=d3.max(this.area_stack_data,function(t){return t.values.length}),a=0;a<this.area_stack_data.length;a++){var o=this.area_stack_data[a];o.values.length<r&&o.values.push({x:t.x,y:null})}var h=this.layers;try{this.layers=this.stack(this.area_stack_data)}catch(t){this.layers=h}this.master_detail&&(this.dataChanged=!0),s||(this.setup?this._animate_draw():(this.rubix.resetAxis(!0),this.rubix.forceRedraw()))}},Rubix.StackedAreaSeries.prototype._animate_draw=function(){for(var t=this.root.selectAll(".y.axis").selectAll("text")[0],i=[],s=0;s<t.length;s++)i.push(t[s].getBBox().width);d3.max(i);this.rubix.resetAxis(!0),this.rubix.runCommand("globalRedraw"),t=this.root.selectAll(".y.axis").selectAll("text")[0],i=[];for(s=0;s<t.length;s++)i.push(t[s].getBBox().width);var e=d3.max(i);this.rubix.marginLeft(e),this.rubix.resetFocus()},Rubix.StackedAreaSeries.prototype.hidden=function(){this.chart_hidden=!0},Rubix.StackedAreaSeries.prototype.show=function(){for(this.chart_hidden=!1;this.temp_stack.length>1;)"addPoint"===(t=this.temp_stack.shift()).type?this.addPoint(t.data,t.shift,!0):this.removePoint(t.ref);if(this.temp_stack.length){var t=this.temp_stack.shift();"addPoint"===t.type?this.addPoint(t.data,t.shift,!0):this.removePoint(t.ref)}},Rubix.StackedAreaSeries.prototype.globalRedraw=function(t){this.stacked_area_series.select("."+this.id+"-line").attr("d",this.line)},Rubix.StackedAreaSeries.prototype.forceRedraw=function(t){this.redraw(t)},Rubix.StackedAreaSeries.prototype.on_complete_draw=function(){if(this.setup){var t=this;if(void 0!==this.opts.marker&&this.show_markers)switch(this.master_detail&&this.rubix.symbols.attr("clip-path","url(#"+t.rubix.master_id+"-clip-symbols)"),this.markers=this.rubix.symbols.selectAll("."+this.id+"-marker"),this.opts.marker){case"circle":case"cross":case"square":case"diamond":case"triangle-up":case"triangle-down":var i=d3.svg.symbol();i.type(this.opts.marker);var s=this.markers.data(this.data[this.name]);s.enter().append("path").attr("d",i).attr("class",this.id+"-marker").attr("fill",this.opts.color).style("display",function(i){return"expand"===t.rubix.area_offset?0===i.y_new&&1===i.y0?"none":null:null===i.y_new?"none":null}).attr("stroke","white").attr("transform",function(i){var s=i.y0+i.y_new;if(isNaN(s)&&(s=0),t.rubix.opts.invertAxes){var e=t.rubix.y(i.x),a=t.rubix.x(s);"column"!==t.rubix.axis.y.range&&"bar"!==t.rubix.axis.y.range||(e+=t.rubix.y.rangeBand()/2)}else{var e=t.rubix.y(s),a=t.rubix.x(i.x);"column"!==t.rubix.axis.x.range&&"bar"!==t.rubix.axis.x.range||(a+=t.rubix.x.rangeBand()/2)}return"translate("+a+","+e+")"}),s.exit().remove();break;default:throw new Error("Unknown marker type : "+this.opts.marker)}}},Rubix.StackedAreaSeries.prototype.setupFocus=function(){if(this.setup)switch(this.focus&&this.focus.remove(),this.focus=this.rubix.focus_group.append("g"),this.focus.attr("class","focus"),this.focus.style("display","none"),this.opts.marker){case"circle":case"cross":case"square":case"diamond":case"triangle-up":case"triangle-down":var t=d3.svg.symbol();t.type(this.opts.marker);this.focus.append("path").attr("d",t).attr("fill",this.opts.color).attr("stroke","white").attr("stroke-width",2);break;default:throw new Error("Unknown marker type : "+this.opts.marker)}},Rubix.StackedAreaSeries.prototype.on_focus=function(){this.setup&&this.linePath.attr("stroke-width",2*this.opts.strokewidth)},Rubix.StackedAreaSeries.prototype.off_focus=function(){this.setup&&this.linePath.attr("stroke-width",2*this.opts.strokewidth)},window.Rubix=window.Rubix||{};var slugify=function(t){return t=t.replace(/[^-a-zA-Z0-9,&\s]+/gi,""),t=t.replace(/-/gi,"_"),t=t.replace(/\s/gi,"-")};Rubix.Pie=function(t,i){return new Rubix.PieDonut(t,"pie",i)},Rubix.Donut=function(t,i){return new Rubix.PieDonut(t,"donut",i)},Rubix.PieDonut=function(t,i,s){s=s||{},this.type=i,this.is_touch_device="ontouchstart"in document.documentElement,this.legend_hidden={},this.chart_counter=0,this.master_id=this.uid("master_id"),this.area_stack_data_stack=[],this.column_stack_data_stack=[],this.root_elem=$(t),this.root_elem.css("position","relative"),this.root_elem.addClass("rubixccnium-main-chart"),this.root_elem.append('<div class="rubixccnium-tooltip"></div>'),this.root_elem.append('<div class="rubixccnium-title"></div>'),this.root_elem.append('<div class="rubixccnium-subtitle"></div>'),this.root_elem.append('<div class="rubixccnium-chart"><div style="margin-top:5px">Loading...</div></div>'),this.root_elem.append('<div class="rubixccnium-legend"></div>');var e=s.width||"100%",a=s.height||150;this.elem_width=e,this.elem_height=a,this.root_elem.width(e).height(a),this.elem=this.root_elem.find(".rubixccnium-chart"),this.tooltip=this.root_elem.find(".rubixccnium-tooltip"),this.tooltip.hide(),this.tooltip.html(""),s.tooltip=s.tooltip||{},this.tooltip.css({"font-family":'Lato, "Lucida Grande", Arial, Helvetica, sans-serif',"font-size":"12px",position:"absolute",background:"white",color:"#89949B",display:"none",padding:"5px 15px","pointer-events":"none","border-radius":"5px","z-index":100,"min-height":50,"user-select":"none",cursor:"default",border:"3px solid "+(s.tooltip.color?s.tooltip.color:"#89949B"),"box-shadow":"rgba(0, 0, 0, 0.2) 2px 4px 8px",background:"white"}),s.legend=s.legend||{},this.legend=this.root_elem.find(".rubixccnium-legend"),this.legend.css({"font-family":"Lato, 'Lucida Grande', Arial, Helvetica, sans-serif","text-align":"center","margin-top":s.legend.top||"-10px","margin-bottom":s.legend.bottom||"5px","user-select":"none",display:s.hideLegend?"none":"block"}),this.title=this.root_elem.find(".rubixccnium-title"),this.subtitle=this.root_elem.find(".rubixccnium-subtitle"),this.title.css({"font-family":"Lato, 'Lucida Grande', Arial, Helvetica, sans-serif","text-align":"center","user-select":"none","font-weight":"bold","font-size":"16px",color:"steelblue","margin-top":"10px",cursor:"default"}),this.subtitle.css({"font-family":"Lato, 'Lucida Grande', Arial, Helvetica, sans-serif","text-align":"center","user-select":"none","font-size":"10px",color:"steelblue","margin-top":"10px",cursor:"default",opacity:.8});this.elem.css({width:"100%",height:parseInt(this.root_elem.get(0).style.height),"user-select":"none",cursor:"default"}),this.root_elem.css("height","100%"),this.opts=s||{},this.data=[],this.is_touch_device="ontouchstart"in document.documentElement,this.d3_eventSource=function(){for(var t,i=d3.event;t=i.sourceEvent;)i=t;return i},this.last_render=null,this.data_changed=!1,this.setup()},Rubix.PieDonut.prototype.setup=function(){this._setupOpts(),this._setupOnce(),this._setupRedraw(),this.draw()},Rubix.PieDonut.prototype._setupOpts=function(){this.opts.theme_style=this.opts.theme_style||"light",this.opts.theme_style_color="light"===this.opts.theme_style?"#C0D0E0":"#555",this.opts.theme_focus_line_color="light"===this.opts.theme_style?"#C0D0E0":"#888",this.opts.legend_color_brightness=this.opts.legend_color_brightness||.5,this.opts.global_legend_color=this.opts.global_legend_color||!1,this.opts.titleColor=this.opts.titleColor||"steelblue",this.opts.subtitleColor=this.opts.subtitleColor||"steelblue",this.title.css("color",this.opts.titleColor),this.subtitle.css("color",this.opts.subtitleColor),"dark"===this.opts.theme_style&&this.tooltip.css({color:"#aaa","font-weight":"bold",border:"1px solid #222","background-color":"#303030"}),this.opts.margin=this.opts.margin||{},this.margin={top:this.opts.margin.top||25,left:this.opts.margin.left||25,right:this.opts.margin.right||25,bottom:this.opts.margin.bottom||25},this.opts.tooltip=this.opts.tooltip||{},this.opts.tooltip.format=this.opts.tooltip.format||{},this.tooltipFormatter={format:{x:this.opts.tooltip.format.x||"",y:this.opts.tooltip.format.y||""}},this.resize=this.opts.resize||"throttled",this.opts.title=this.opts.title||"",this.opts.subtitle=this.opts.subtitle||"",this.title.html(this.opts.title),this.subtitle.html(this.opts.subtitle),(this.opts.title.length||this.opts.subtitle.length)&&this.elem.css("margin-top","-20px"),this.opts.title.length?this.title.show():this.title.hide(),this.opts.subtitle.length?this.subtitle.show():this.subtitle.hide()},Rubix.PieDonut.prototype._setupOnce=function(){},Rubix.PieDonut.prototype._setupRedraw=function(){var t=this;switch($(window).on("orientationchange",function(){t.draw()}),$(window).on("rubix.redraw."+this.master_id,function(){t.draw()}),this.resize){case"always":$(window).on("resize",function(){t.draw()});break;case"debounced":$(window).on("debouncedresize",function(){t.draw()});break;case"throttled":$(window).on("throttledresize",function(){t.draw()});break;default:throw new Error("Unknown resize type!")}},Rubix.PieDonut.prototype.draw=function(){this._draw()},Rubix.PieDonut.prototype._draw=function(){this._cleanElement(),this._setSize(),this._setupCanvas(),this._setupRoot(),this._setupSeries(),this.final_draw()},Rubix.PieDonut.prototype._cleanElement=function(){this.elem.children().remove()},Rubix.PieDonut.prototype._setSize=function(){this.outerWidth=this.elem.width(),this.outerHeight=this.elem.height(),this.width=this.outerWidth-this.margin.left-this.margin.right,this.height=this.outerHeight-this.margin.top-this.margin.bottom,this.innerRadius=0,this.outerRadius=.5*Math.min(this.width,this.height)-10,"donut"===this.type&&(this.innerRadius=.6*this.outerRadius)},Rubix.PieDonut.prototype._setupCanvas=function(){this.elem.html(""),this.canvas=d3.select(this.elem.get(0)).append("svg"),this.canvas.attr("width",this.outerWidth),this.canvas.attr("height",this.outerHeight),this.canvas.append("desc").text("Powered by RubixÆžium")},Rubix.PieDonut.prototype._setupRoot=function(){this.root=this.canvas.append("g"),this.root.attr("width",this.width),this.root.attr("height",this.height),this.root.attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.hasData?this.canvas.select(".noData").style("display","none"):this.canvas.append("text").attr("class","noData").attr("font-size","30px").attr("text-anchor","middle").attr("transform","translate("+this.outerWidth/2+","+this.outerHeight/2+")").attr("font-family",'Lato, "Lucida Grande", Arial, Helvetica, sans-serif').text("No Data")},Rubix.PieDonut.prototype._setupSeries=function(){this.root_piedonut_series=this.root.append("g").attr("class","piedonut_series").attr("transform","translate("+this.width/2+","+this.height/2+")")},Rubix.PieDonut.prototype.uid=function(t){return"rubixcc-pie-donut-"+t+"-"+Math.floor(2147483648*Math.random()).toString(36)},Rubix.PieDonut.prototype.addData=function(t){this.data_changed=!0,t.forEach(function(t){t.value=+t.value}),this.data=t,this._setupLegend(),this.final_draw("launch")},Rubix.PieDonut.prototype._setupLegend=function(){var t=this;this.legend.children().remove();for(var i=0;i<this.data.length;i++){var s=this.opts.global_legend_color||this.data[i].color;this.legend.append("<div class='"+this.master_id+"-legend-labels' data-name='"+this.data[i].name+"' style='cursor: pointer; display: inline-block; font-weight: bold; margin-right: 10px; color: "+s+"'><span style='font-size: 22px;'>■ </span><span style='font-size: 12px; position:relative; top: -3px; left: -2px;'>"+this.data[i].name+"</span></div>")}$("."+this.master_id+"-legend-labels").css({opacity:.9});for(var e in this.legend_hidden){var a=this.legend_hidden[e];$("[data-name="+a+"]").css({opacity:.2}).addClass("toggle")}$("."+this.master_id+"-legend-labels").off().on({hover:function(i){var s=$(this).hasClass("toggle"),e=$(this).attr("data-name"),a="#"+t.master_id+"-"+slugify(e);if(!s)switch(i.type){case"mouseenter":$(this).css({opacity:1}),d3.select(a).node().__onmouseover(i);break;case"mouseleave":$(this).css({opacity:.9}),d3.select(a).node().__onmouseout(i)}},click:function(i){var s=$(this).hasClass("toggle"),e=$(this).attr("data-name"),a="#"+t.master_id+"-"+slugify(e);s?($(this).css({opacity:1}),$(this).removeClass("toggle"),$(a).fadeIn(),delete t.legend_hidden[a]):($(this).css({opacity:.2}),$(this).addClass("toggle"),$(a).fadeOut(),t.legend_hidden[a]=e)}})},Rubix.PieDonut.prototype.final_draw=function(t){var i=this;this.data.length&&this.canvas.select(".noData").style("display","none");var s=d3.svg.arc();s.innerRadius(this.innerRadius),s.outerRadius(this.outerRadius);var e=d3.layout.pie();e.sort(null),e.value(function(t){return t.value});var a=this.root_piedonut_series.selectAll(".arc").data(e(this.data),function(t){return t.data.name}),r=a.enter().append("g").attr("class","arc").style("position","relative"),o=(d3.scale.category20(),r.attr("id",function(t){return i.master_id+"-"+slugify(t.data.name)}).style("fill",function(t,i){return t.data.color}).style("stroke","white").append("path").attr("d",function(t){return s({startAngle:0,endAngle:0})}));"launch"===t?(this.old_pie_data=e(this.data),setTimeout(function(){o.transition().attrTween("d",function(t){var i=d3.interpolate({startAngle:0,endAngle:0},{startAngle:t.startAngle,endAngle:t.endAngle});return function(t){return s(i(t))}}).duration(500)},15)):"add"===t?a.transition().duration(500).each("end",function(){i.old_pie_data=e(i.data)}).select("path").attrTween("d",function(t,e){var a=0,r=0;try{a=i.old_pie_data[e].startAngle,r=i.old_pie_data[e].endAngle}catch(t){a=i.old_pie_data[i.old_pie_data.length-1].startAngle,r=i.old_pie_data[i.old_pie_data.length-1].endAngle}var o=d3.interpolate({startAngle:a,endAngle:r},{startAngle:t.startAngle,endAngle:t.endAngle});return t.data.hasOwnProperty("_remove")&&i.data.splice(e,1),i._setupLegend(),function(t){return s(o(t))}}):(this.old_pie_data=e(this.data),o.attr("d",function(t){return s(t)}));var h="mouseover",n="mousemove",l="mouseout";this.is_touch_device&&(h="touchstart",n="touchstart",l="touchend");var d;r.on(h,function(t){clearTimeout(d);var e=s.centroid(t),a=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),r=e[0]/a*8,o=e[1]/a*8;i.is_touch_device||d3.select(this).transition().duration(150).attr("transform","translate("+[r,o]+")")}),r.on(n,function(t,s){if(clearTimeout(d),i.is_touch_device)e=d3.touches(this,i.d3_eventSource().changedTouches)[0];else var e=d3.mouse(this);if(i.tooltip.css("display",useTable),i.tooltip.css({left:i.width/2-i.margin.left/2+e[0],top:i.height/2-i.margin.top/2+e[1]}),i.opts.tooltip.customPlaceholder){var a=i.opts.tooltip.customPlaceholder.replace("%n",t.data.name);a=(a=a.replace("%v",t.data.value)).replace("%c",t.data.color),i.tooltip.html(a)}else i.tooltip.html("<div style='color: "+t.data.color+";'><b><span style='font-size: 22px;'>■ </span><span style='position:relative; top: -3px; left: -2px;'>"+t.data.name+" :</span></b> <span style='position:relative; top: -3px; left: -2px;'>"+t.data.value+"</span></div>");d3.select(this).style("fill",t.data.color)}),r.on(l,function(t,s){var e=this;i.is_touch_device?(d=setTimeout(function(){i.tooltip.hide()},3e3),setTimeout(function(){d3.select(e).style("fill",t.data.color)},3e3)):(i.tooltip.hide(),d3.select(e).style("fill",t.data.color),d3.select(e).transition().duration(150).attr("transform","translate(0, 0)"))}),a.exit().remove();for(var u in this.legend_hidden)$(u).hide()},Rubix.PieDonut.prototype.removePoint=function(t){for(var i=!1,s=0;s<this.data.length;s++)if(this.data[s].name===t){i=!0,this.data[s].value=0,this.data[s]._remove=!0;break}i&&this.final_draw("add")},Rubix.PieDonut.prototype.updatePoint=function(t){this.addPoint(t)},Rubix.PieDonut.prototype.addPoint=function(t){this.data_changed=!0;for(var i=!1,s=0;s<this.data.length;s++)if(this.data[s].name===t.name){i=!0,this.data[s].value=+t.value;break}i||this.data.push(t),this.final_draw("add")},window.Rubix=window.Rubix||{},Rubix.LineSeries=function(t,i){if(this.opts=i,this.opts.color=this.opts.color||"steelblue",this.opts.marker=this.opts.marker||"circle",this.opts.scatter=this.opts.scatter||!1,this.opts.noshadow=this.opts.noshadow||!1,this.show_markers=this.opts.show_markers,this.opts.strokewidth=this.opts.strokewidth||1,!this.opts.hasOwnProperty("name"))throw new Error("LineSeries should have a 'name' property");this.name=this.opts.name,this.chart_hidden=!1,this.temp_stack=[],this.setup=!1,this._setup(t)},Rubix.LineSeries.prototype._setup=function(t){this.rubix=t,this.root=this.rubix.root,this.data=this.rubix.data,this.width=this.rubix.width,this.height=this.rubix.height,this.line_series=this.rubix.root_line_series,this.show_markers=void 0===this.show_markers?this.rubix.show_markers:this.show_markers,this.master_detail=this.rubix.master_detail,this.master_detail&&(this.md_root=this.rubix.md_root),this.id||(this.id=this.rubix.uid("line"));var i=this;this.line=d3.svg.line(),this.line.defined(function(t){return null!==t.x&&null!==t.y}),this.line.x(function(t){return i.rubix.opts.invertAxes?i.rubix.x(t.y):"column"===i.rubix.axis.x.range||"bar"===i.rubix.axis.x.range?i.rubix.x(t.x)+i.rubix.x.rangeBand()/2:i.rubix.x(t.x)}),this.line.y(function(t){return i.rubix.opts.invertAxes?"column"===i.rubix.axis.y.range||"bar"===i.rubix.axis.y.range?i.rubix.y(t.x)+i.rubix.y.rangeBand()/2:i.rubix.y(t.x):i.rubix.y(t.y)}),this.line.interpolate(this.rubix.interpolate),this.master_detail&&(this.master_line=d3.svg.line(),this.master_line.defined(function(t){return null!==t.x&&null!==t.y}),this.master_line.x(function(t){return i.rubix.opts.invertAxes?i.rubix.x2(t.y):i.rubix.x2(t.x)}),this.master_line.y(function(t){return i.rubix.opts.invertAxes?i.rubix.y2(t.x):i.rubix.y2(t.y)}),this.master_line.interpolate(this.rubix.interpolate))},Rubix.LineSeries.prototype.redraw=function(t){this._setup(t),this.draw()},Rubix.LineSeries.prototype.noRedraw=function(t){this._setup(t),this.draw(!0)},Rubix.LineSeries.prototype.addData=function(t){if(this.rubix.data_changed=!0,!(t instanceof Array)){if(!(t instanceof Object))throw new Error("Data must be an array or object");if(!t.hasOwnProperty("x")&&!t.hasOwnProperty("y"))throw new Error("Object must be in the form: {x: ..., y: ...}");t=[t]}t.length&&(this.rubix.opts.noSort||t.sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1}),this.data[this.name]=t,this.rubix.resetAxis(!1),this.rubix.forceRedraw(),this._animate_draw())},Rubix.LineSeries.prototype.draw=function(t){if(this.name&&this.data&&this.data.hasOwnProperty(this.name)&&this.data[this.name].length){i=this;if(this.line_series.selectAll("."+this.id)[0].length)this.rubix.runCommand("globalRedraw");else{if(this.line_series.selectAll("."+this.id+".clipped").remove(),this.opts.scatter||(this.opts.noshadow||(this.strokePath1=this.line_series.append("path").attr("class",this.id+" line").datum(this.data[this.name]).attr("d",this.line).attr("stroke","black").attr("fill","none").attr("stroke-linecap","round").attr("stroke-width",5*this.opts.strokewidth).attr("stroke-opacity",.05000000000000001).attr("transform","translate(1,1)"),this.strokePath2=this.line_series.append("path").attr("class",this.id+" line").datum(this.data[this.name]).attr("d",this.line).attr("stroke","black").attr("fill","none").attr("stroke-linecap","round").attr("stroke-width",3*this.opts.strokewidth).attr("stroke-opacity",.1).attr("transform","translate(1,1)"),this.strokePath3=this.line_series.append("path").attr("class",this.id+" line").datum(this.data[this.name]).attr("d",this.line).attr("stroke","black").attr("fill","none").attr("stroke-linecap","round").attr("stroke-width",1*this.opts.strokewidth).attr("stroke-opacity",.15000000000000002).attr("transform","translate(1,1)")),this.linePath=this.line_series.append("path").datum(this.data[this.name]).attr("class",this.id+" line").attr("stroke",this.opts.color).attr("fill","none").attr("stroke-linecap","round").attr("d",this.line).attr("stroke-width",2*this.opts.strokewidth)),this.master_detail){if(this.opts.scatter){this.md_root.select(".md-layers > .md_line_series").attr("clip-path","url(#"+i.rubix.master_id+"-clip)");var i=this,s=this.data[this.name];switch(this.markers_master=this.md_root.select(".md-layers > .md_line_series").selectAll("."+this.id+"-marker"),this.opts.marker){case"circle":case"cross":case"square":case"diamond":case"triangle-up":case"triangle-down":var e=d3.svg.symbol();e.type(this.opts.marker);var a=this.markers_master.data(s);a.enter().append("path").attr("d",e).attr("class",this.id+"-marker").attr("fill",this.opts.color).style("display",function(t){return null===t.y?"none":null}).attr("stroke","none").attr("transform",function(t){var s=t.y;if(isNaN(s)&&(s=0),i.rubix.opts.invertAxes){var e=i.rubix.y(t.x),a=i.rubix.x(s);"column"!==i.rubix.axis.y.range&&"bar"!==i.rubix.axis.y.range||(e+=i.rubix.y.rangeBand()/2)}else{var e=i.rubix.y2(s),a=i.rubix.x2(t.x);"column"!==i.rubix.axis.x.range&&"bar"!==i.rubix.axis.x.range||(a+=i.rubix.x.rangeBand()/2)}return"translate("+a+","+e+")"}),a.exit().remove();break;default:throw new Error("Unknown marker type : "+this.opts.marker)}}else this.md_root.select(".md-layers > .md_line_series").selectAll("."+this.id+".clipped").remove(),this.masterLinePath=this.md_root.select(".md-layers > .md_line_series").append("path").datum(this.data[this.name]).attr("class",this.id+" line").attr("stroke",this.opts.color).attr("fill","none").attr("stroke-linecap","round").attr("d",this.master_line).attr("stroke-width",2*this.opts.strokewidth),this.masterLinePath.attr("clip-path","url(#"+i.rubix.master_id+"-clip)"),this.masterLinePath.classed("clipped",!0);this.dataChanged&&(this.rubix.resetExtent(),this.dataChanged=!1),this.opts.scatter||(this.opts.noshadow||(this.strokePath1.attr("clip-path","url(#"+i.rubix.master_id+"-clip)"),this.strokePath2.attr("clip-path","url(#"+i.rubix.master_id+"-clip)"),this.strokePath3.attr("clip-path","url(#"+i.rubix.master_id+"-clip)")),this.linePath.attr("clip-path","url(#"+i.rubix.master_id+"-clip)"),this.opts.noshadow||(this.strokePath1.classed("clipped",!0),this.strokePath2.classed("clipped",!0),this.strokePath3.classed("clipped",!0)),this.linePath.classed("clipped",!0))}this.setup=!0}this.rubix.resetFocus(t)}},Rubix.LineSeries.prototype.update=function(t){if(!(t instanceof Array)){if(!(t instanceof Object))throw new Error("Data must be an array or object");if(!t.hasOwnProperty("x")&&!t.hasOwnProperty("y"))throw new Error("Object must be in the form: {x: ..., y: ...}");t=[t]}this.rubix.opts.noSort||t.sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1}),this.data[this.name]=t,this.setup?this._animate_draw():(this.rubix.resetAxis(!1),this.rubix.forceRedraw())},Rubix.LineSeries.prototype.updatePoint=function(t,i,s){this.addPoint(t,i,s)},Rubix.LineSeries.prototype.removePoint=function(t,i){if(this.chart_hidden)this.temp_stack.push({type:"removePoint",ref:t});else{this.data[this.name]||(this.data[this.name]=[]);for(var s=0;s<this.data[this.name].length;s++)if(this.data[this.name][s].x===t){this.data[this.name].splice(s,1),!0;break}this.master_detail&&(this.dataChanged=!0),i||(this.setup?this._animate_draw():(this.rubix.resetAxis(!0),this.rubix.forceRedraw()))}},Rubix.LineSeries.prototype.addPoint=function(t,i,s){if(this.rubix.data_changed=!0,!(t instanceof Object)||t instanceof Array)throw new Error("Object required for addPoint");if(!t.hasOwnProperty("x")&&!t.hasOwnProperty("y"))throw new Error("Object must be in the form: {x: ..., y: ...}");if(this.chart_hidden)this.temp_stack.push({type:"addPoint",data:t,shift:i});else{this.data[this.name]||(this.data[this.name]=[]);for(var e=!1,a=0;a<this.data[this.name].length;a++)if(this.data[this.name][a].x===t.x){this.data[this.name][a].y=t.y,e=!0;break}e||this.data[this.name].push(t),this.data[this.name].sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1}),this.rubix.opts.interval?this.rubix.opts.interval<this.data[this.name].length&&this.data[this.name].shift():i&&this.data[this.name].shift(),this.master_detail&&(this.dataChanged=!0),s||(this.setup?this._animate_draw():(this.rubix.resetAxis(!0),this.rubix.forceRedraw()))}},Rubix.LineSeries.prototype._animate_draw=function(){for(var t=this.root.selectAll(".y.axis").selectAll("text")[0],i=[],s=0;s<t.length;s++)i.push(t[s].getBBox().width);d3.max(i);this.rubix.resetAxis(!0),this.rubix.runCommand("globalRedraw"),t=this.root.selectAll(".y.axis").selectAll("text")[0],i=[];for(s=0;s<t.length;s++)i.push(t[s].getBBox().width);var e=d3.max(i);this.rubix.marginLeft(e),this.rubix.resetFocus()},Rubix.LineSeries.prototype.hidden=function(){this.chart_hidden=!0},Rubix.LineSeries.prototype.show=function(){for(this.chart_hidden=!1;this.temp_stack.length>1;)"addPoint"===(t=this.temp_stack.shift()).type?this.addPoint(t.data,t.shift,!0):this.removePoint(t.ref);if(this.temp_stack.length){var t=this.temp_stack.shift();"addPoint"===t.type?this.addPoint(t.data,t.shift,!0):this.removePoint(t.ref)}},Rubix.LineSeries.prototype.globalRedraw=function(t){this.line_series.selectAll("."+this.id+".line").attr("d",this.line)},Rubix.LineSeries.prototype.forceRedraw=function(t){this.redraw(t)},Rubix.LineSeries.prototype.on_complete_draw=function(){if(this.setup){var t=this,i=this.data[this.name];if(void 0!==this.opts.marker&&this.show_markers)switch(this.master_detail&&this.rubix.symbols.attr("clip-path","url(#"+t.rubix.master_id+"-clip-symbols)"),this.markers=this.rubix.symbols.selectAll("."+this.id+"-marker"),this.opts.marker){case"circle":case"cross":case"square":case"diamond":case"triangle-up":case"triangle-down":var s=d3.svg.symbol();s.type(this.opts.marker);var e=this.markers.data(i);e.enter().append("path").attr("d",s).attr("class",this.id+"-marker").attr("fill",this.opts.color).style("display",function(t){return null===t.y?"none":null}).attr("stroke","white").attr("transform",function(i){var s=i.y;if(isNaN(s)&&(s=0),t.rubix.opts.invertAxes){var e=t.rubix.y(i.x),a=t.rubix.x(s);"column"!==t.rubix.axis.y.range&&"bar"!==t.rubix.axis.y.range||(e+=t.rubix.y.rangeBand()/2)}else{var e=t.rubix.y(s),a=t.rubix.x(i.x);"column"!==t.rubix.axis.x.range&&"bar"!==t.rubix.axis.x.range||(a+=t.rubix.x.rangeBand()/2)}return"translate("+a+","+e+")"}),e.exit().remove();break;default:throw new Error("Unknown marker type : "+this.opts.marker)}}},Rubix.LineSeries.prototype.setupFocus=function(){if(this.setup)switch(this.focus&&this.focus.remove(),this.focus=this.rubix.focus_group.append("g"),this.focus.attr("class","focus"),this.focus.style("display","none"),this.opts.marker){case"circle":case"cross":case"square":case"diamond":case"triangle-up":case"triangle-down":var t=d3.svg.symbol();t.type(this.opts.marker);this.focus.append("path").attr("d",t).attr("fill",this.opts.color).attr("stroke","white").attr("stroke-width",2);break;default:throw new Error("Unknown marker type : "+this.opts.marker)}},Rubix.LineSeries.prototype.on_focus=function(){this.setup&&this.linePath.attr("stroke-width",2*this.opts.strokewidth)},Rubix.LineSeries.prototype.off_focus=function(){this.setup&&this.linePath.attr("stroke-width",2*this.opts.strokewidth)},window.Rubix=window.Rubix||{},Rubix.ColumnSeries=function(t,i){if(this.type="column_series",this.opts=i,this.opts.color=this.opts.color||"steelblue",this.opts.marker=this.opts.marker||"circle",this.opts.nostroke=this.opts.nostroke||"",this.opts.fillopacity=this.opts.fillopacity||.85,this.show_markers=this.opts.show_markers,!this.opts.hasOwnProperty("name"))throw new Error("ColumnSeries should have a 'name' property");this.name=this.opts.name,this.chart_hidden=!1,this.temp_stack=[],this.setup=!1,this.last_stack=[],this.last_stack_name="",this.last_stack_added=!1,this.count=0,this._setup(t)},Rubix.ColumnSeries.prototype._setup=function(t){this.rubix=t,this.rubix.stacked=!0,this.root=this.rubix.root,this.data=this.rubix.data,this.width=this.rubix.width,this.height=this.rubix.height,this.stack=this.rubix.column_stack,this.offset=this.rubix.column_offset,this.cb_series=this.rubix.root_cb_series,this.column_stack=this.rubix.column_stack_data,this.show_markers=void 0===this.show_markers?this.rubix.show_markers:this.show_markers,this.grouped=this.rubix.grouped,this.id||(this.id=this.rubix.uid("stacked-column"))},Rubix.ColumnSeries.prototype.redraw=function(t){this._setup(t),this.draw()},Rubix.ColumnSeries.prototype.noRedraw=function(t){this._setup(t),this.draw(!0)},Rubix.ColumnSeries.prototype.addData=function(t){if(this.rubix.data_changed=!0,!(t instanceof Array)){if(!(t instanceof Object))throw new Error("Data must be an array or object");if(!t.hasOwnProperty("x")&&!t.hasOwnProperty("y"))throw new Error("Object must be in the form: {x: ..., y: ...}");t=[t]}if(t.length){this.rubix.opts.noSort||t.sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1});var i=0,s=[];for(var e in this.data)if((r=this.data[e].length)>i){i=r,s=[];for(var a=0;a<i;a++)s.push(this.data[e][a].x)}this.rubix.maxLen=i,this.data[this.name]=t;for(var e in this.data){var r=this.data[e].length;if(r<i){for(var o=s.concat(),h=0;h<this.data[e].length;h++){var n=o.indexOf(this.data[e][h].x);o.splice(n,1)}for(h=0;h<o.length;h++)this.rubix.charts[e].addPoint({x:o[h],y:null})}}this.column_stack.push({key:this.name,color:this.opts.color,marker:this.opts.marker,values:this.data[this.name],orderKey:this.column_stack.length}),this.rubix.resetAxis(),this.rubix.forceRedraw(),this._animate_draw()}},Rubix.ColumnSeries.prototype._createRect=function(){var t=this,i="white";this.opts.nostroke&&(i="none");var s=this.columnGroup.selectAll("rect").data(function(t){return t.values}).enter().append("rect").attr("stroke",i);this.grouped?this.rubix.opts.invertAxes?(s.attr("x",function(i,s,e){var a=t.rubix.x(0);return isNaN(a)?null:a}),s.attr("y",function(i,s,e){return t.rubix.y(i.x)+t.rubix.y.rangeBand()/t.layers.length*e}),s.attr("class",function(i,s,e){return"column-"+(t.rubix.y(i.x)+t.rubix.y.rangeBand()/t.layers.length*(t.layers.length-1)+t.rubix.y.rangeBand()/(2*t.layers.length))}),s.attr("width",function(i){var s=Math.abs(t.rubix.x(i.y)-t.rubix.x(0));return isNaN(s)?null:s}),s.attr("height",t.rubix.y.rangeBand()/t.layers.length),s.attr("transform",function(i){var s=t.rubix.x(i.y_new)-t.rubix.x(0);return i.y<0?"translate("+-Math.abs(s)+",0)":"translate(0,0)"})):(s.attr("x",function(i,s,e){return t.rubix.x(i.x)+t.rubix.x.rangeBand()/t.layers.length*e}),s.attr("y",function(i){var s=t.rubix.y(0);return isNaN(s)?null:s}),s.attr("class",function(i,s,e){return"column-"+(t.rubix.x(i.x)+t.rubix.x.rangeBand()/t.layers.length*(t.layers.length-1)+t.rubix.x.rangeBand()/(2*t.layers.length))}),s.attr("width",t.rubix.x.rangeBand()/t.layers.length),s.attr("height",function(i){var s=Math.abs(t.rubix.y(i.y)-t.rubix.y(0));return isNaN(s)?null:s}),s.attr("transform",function(i){var s=t.rubix.y(i.y_new)-t.rubix.y(0);return i.y>0?"translate(0,"+-Math.abs(s)+")":"translate(0,0)"})):this.rubix.opts.invertAxes?(s.attr("x",function(i){var s=t.rubix.x(i.y0);return isNaN(s)?null:s}),s.attr("y",function(i){return t.rubix.y(i.x)||0}),s.attr("class",function(i){return"column-"+(t.rubix.y(i.x)+t.rubix.y.rangeBand()/2)}),s.attr("width",function(i){var s=Math.abs(t.rubix.x(i.y0)-t.rubix.x(i.y+i.y0));return isNaN(s)?null:s}),s.attr("height",t.rubix.y.rangeBand()),s.attr("transform",function(i){return i.y<0?"translate("+-Math.abs(t.rubix.x(i.y0)-t.rubix.x(i.y+i.y0))+",0)":null})):(s.attr("x",function(i){return t.rubix.x(i.x)}),s.attr("y",function(i){var s=t.rubix.y(i.y0);return isNaN(s)?null:s}),s.attr("class",function(i){return"column-"+(t.rubix.x(i.x)+t.rubix.x.rangeBand()/2)}),s.attr("width",t.rubix.x.rangeBand()),s.attr("height",function(i){var s=Math.abs(t.rubix.y(i.y0)-t.rubix.y(i.y+i.y0));return isNaN(s)?null:s}),s.attr("transform",function(i){return i.y>0?"translate(0,"+-Math.abs(t.rubix.y(i.y0)-t.rubix.y(i.y+i.y0))+")":null}))},Rubix.ColumnSeries.prototype.draw=function(t){try{if(!this.name)return;if(!this.data)return;if(!this.data.hasOwnProperty(this.name))return;if(!this.data[this.name].length)return;var i=this.layers;try{this.layers=this.stack(this.column_stack)}catch(t){this.layers=i}if(!this.grouped)for(var s=this.rubix.maxLen,e=0;e<s;e++){for(var a=this.layers[0].values[e].x,r=null,o=0;o<this.layers.length;o++)for(h=0;h<s;h++)try{if(this.layers[o].values[h].x===a){this.layers[o].values[h].y>=0&&(null===this.layers[o].values[h].y?this.layers[o].values[h].y0=null:(null===r&&(r=0),this.layers[o].values[h].y0=r,r+=this.layers[o].values[h].y));break}}catch(t){this.layers[o].values.push({x:a,y:null,y0:null,y_new:null})}r=null;for(o=this.layers.length-1;o>=0;o--)for(var h=0;h<s;h++)try{if(this.layers[o].values[h].x===a){this.layers[o].values[h].y<0&&(null===this.layers[o].values[h].y?this.layers[o].values[h].y0=null:(null===r&&(r=0),this.layers[o].values[h].y0=-r,r+=Math.abs(this.layers[o].values[h].y)));break}}catch(t){this.layers[o].values.push({x:a,y:null,y0:null,y_new:null})}}var n=this;if(this.cb_series.selectAll("."+this.id)[0].length)this.rubix.runCommand("globalRedraw");else{try{this.cb_series.selectAll(".column-layer").remove();var l=this.cb_series.selectAll(".column-layer").data(this.layers,function(t,i){return t.key===n.name&&(n.count=i),t.key});this.columnGroup=l.enter().append("g"),this.columnGroup.attr("class","column-layer").attr("fill",function(t){return t.color}).attr("fill-opacity",this.opts.fillopacity),this._createRect(),l.exit().remove()}catch(t){}this.setup=!0}this.rubix.resetFocus(t)}catch(t){}},Rubix.ColumnSeries.prototype.update=function(t){if(!(t instanceof Array)){if(!(t instanceof Object))throw new Error("Data must be an array or object");if(!t.hasOwnProperty("x")&&!t.hasOwnProperty("y"))throw new Error("Object must be in the form: {x: ..., y: ...}");t=[t]}this.rubix.opts.noSort||t.sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1}),this.data[this.name]=t,this.setup?this._animate_draw():(this.rubix.resetAxis(!0),this.rubix.forceRedraw())},Rubix.ColumnSeries.prototype.updatePoint=function(t,i,s){this.addPoint(t,i,s)},Rubix.ColumnSeries.prototype.removePoint=function(t,i){if(this.chart_hidden)this.temp_stack.push({type:"removePoint",ref:t});else{this.data[this.name]||(this.data[this.name]=[]);for(var s=!1,e=0,a=0;a<this.data[this.name].length;a++)if(this.data[this.name][a].x===t){this.data[this.name][a].y=null,this.data[this.name][a].y0=null,this.data[this.name][a].y_new=null,e=a,s=!0;break}if(s){for(var r=!1,a=0;a<this.column_stack.length;a++){var o=this.column_stack[a];try{if(o.values[e].x===t&&null!==o.values[e].y){r=!0;break}}catch(t){}}if(!r)for(a=0;a<this.column_stack.length;a++)this.column_stack[a].values.splice(e,1);var h=0;for(var a in this.data){var n=this.data[a].length;n>h&&(h=n)}this.rubix.maxLen=h,i||(this.rubix.resetAxis(),this.rubix.forceRedraw(),this._animate_draw())}}},Rubix.ColumnSeries.prototype.addPoint=function(t,i,s){if(this.rubix.data_changed=!0,!(t instanceof Object)||t instanceof Array)throw new Error("Object required for addPoint");if(!t.hasOwnProperty("x")&&!t.hasOwnProperty("y"))throw new Error("Object must be in the form: {x: ..., y: ...}");if(this.chart_hidden)this.temp_stack.push({type:"addPoint",data:t,shift:i});else{this.data[this.name]||(this.data[this.name]=[]);for(var e=!1,a=0;a<this.data[this.name].length;a++)if(this.data[this.name][a].x===t.x){this.data[this.name][a].y=t.y,e=!0;break}e||this.data[this.name].push(t),this.data[this.name].sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1}),e=!1;for(a=0;a<this.column_stack.length;a++)if(this.column_stack[a].key===this.name){e=!0;break}this.rubix.opts.interval?this.rubix.opts.interval<this.data[this.name].length&&this.data[this.name].shift():i&&this.data[this.name].shift();var r=0,o=[];for(var a in this.data)if((n=this.data[a].length)>r){r=n,o=[];for(var h=0;h<r;h++)o.push(this.data[a][h].x)}this.rubix.maxLen=r;for(var a in this.data){var n=this.data[a].length;if(n<r){for(var l=o.concat(),d=0;d<this.data[a].length;d++){var u=l.indexOf(this.data[a][d].x);l.splice(u,1)}for(d=0;d<l.length;d++)this.rubix.charts[a].addPoint({x:l[d],y:null})}}s||(this.rubix.resetAxis(),this.rubix.forceRedraw(),this._animate_draw())}},Rubix.ColumnSeries.prototype._animate_draw=function(){try{for(var t=this.root.selectAll(".y.axis").selectAll("text")[0],i=[],s=0;s<t.length;s++)i.push(t[s].getBBox().width);d3.max(i);this.rubix.resetAxis(!0),this.rubix.runCommand("globalRedraw"),t=this.root.selectAll(".y.axis").selectAll("text")[0],i=[];for(s=0;s<t.length;s++)i.push(t[s].getBBox().width);var e=d3.max(i);this.rubix.marginLeft(e),this.rubix.resetFocus()}catch(t){}},Rubix.ColumnSeries.prototype.hidden=function(){this.chart_hidden=!0},Rubix.ColumnSeries.prototype.show=function(){for(this.chart_hidden=!1;this.temp_stack.length>1;)"addPoint"===(t=this.temp_stack.shift()).type?this.addPoint(t.data,t.shift,!0):this.removePoint(t.ref);if(this.temp_stack.length){var t=this.temp_stack.shift();"addPoint"===t.type?this.addPoint(t.data,t.shift,!0):this.removePoint(t.ref)}},Rubix.ColumnSeries.prototype.globalRedraw=function(t){},Rubix.ColumnSeries.prototype.forceRedraw=function(t){this.redraw(t)},Rubix.ColumnSeries.prototype.on_complete_draw=function(){if(this.setup){var t=this;if(void 0!==this.opts.marker&&this.show_markers){this.markers=this.rubix.symbols,this.markers.selectAll(".column-symbols").remove();var i=this.markers.selectAll(".column-symbols").data(this.layers,function(t){return t.key}),s=i.enter().append("g");switch(s.attr("class","column-symbols"),this.opts.marker){case"circle":case"cross":case"square":case"diamond":case"triangle-up":case"triangle-down":var e=s.selectAll("path").data(function(t){for(var i=0;i<t.values.length;i++)t.values[i].marker=t.marker,t.values[i].color=t.color;return t.values}).enter().append("path");e.attr("d",function(t){var i=d3.svg.symbol();return i.type(t.marker),i()}).attr("fill",function(t){return t.color}).style("display",function(i){return"expand"===t.rubix.column_offset?0===i.y_new&&1===i.y0?"none":null:null===i.y_new?"none":null}).attr("stroke","white"),this.rubix.opts.invertAxes?e.attr("transform",function(i,s,e){var a=i.y0+i.y_new;isNaN(a)&&(a=0);var r=t.rubix.x(a);t.grouped&&(r=t.rubix.x(i.y_new));var o=t.rubix.y(i.x)+t.rubix.y.rangeBand()/2;return t.grouped&&(o=t.rubix.y(i.x)+t.rubix.y.rangeBand()/t.layers.length*e+t.rubix.y.rangeBand()/(2*t.layers.length)),"translate("+r+","+o+")"}):e.attr("transform",function(i,s,e){var a=i.y0+i.y_new;isNaN(a)&&(a=0);var r=t.rubix.y(a);t.grouped&&(r=t.rubix.y(i.y_new));var o=t.rubix.x(i.x)+t.rubix.x.rangeBand()/2;return t.grouped&&(o=t.rubix.x(i.x)+t.rubix.x.rangeBand()/t.layers.length*e+t.rubix.x.rangeBand()/(2*t.layers.length)),"translate("+o+","+r+")"}),i.exit().remove();break;default:throw new Error("Unknown marker type : "+this.opts.marker)}}}},Rubix.ColumnSeries.prototype.setupFocus=function(){if(this.setup){this.focus&&this.focus.remove(),this.focus=this.rubix.focus_group.append("g"),this.focus.attr("class","focus"),this.focus.style("display","none");switch(this.opts.marker){case"circle":case"cross":case"square":case"diamond":case"triangle-up":case"triangle-down":var t=d3.svg.symbol();t.type(this.opts.marker),this.focus.append("path").attr("d",t).attr("fill",this.opts.color).attr("stroke","white").attr("stroke-width",2);break;default:throw new Error("Unknown marker type : "+this.opts.marker)}}},Rubix.ColumnSeries.prototype.on_focus=function(t,i){if(this.setup){if(this.off_focus(),this.rubix.opts.invertAxes){i=i.toString().replace(".","\\.");s=this.cb_series.selectAll(".column-"+i)}else{t=t.toString().replace(".","\\.");var s=this.cb_series.selectAll(".column-"+t)}s.classed("filled",!0),s.attr("fill-opacity",1),s.attr("stroke-width",2)}},Rubix.ColumnSeries.prototype.off_focus=function(){if(this.setup){var t=this.cb_series.selectAll(".filled");t.classed("filled",!1),t.attr("fill-opacity",.85),t.attr("stroke-width",1)}},window.Rubix=window.Rubix||{},Rubix.AreaSeries=function(t,i){if(this.opts=i,this.opts.color=this.opts.color||"steelblue",this.opts.marker=this.opts.marker||"circle",this.opts.fillopacity=this.opts.fillopacity||.5,this.opts.strokewidth=this.opts.strokewidth||1,this.opts.noshadow=this.opts.noshadow||!1,this.show_markers=this.opts.show_markers,!this.opts.hasOwnProperty("name"))throw new Error("AreaSeries should have a 'name' property");this.name=this.opts.name,this.chart_hidden=!1,this.temp_stack=[],this.setup=!1,this.animating=!1,this._setup(t)},Rubix.AreaSeries.prototype._setup=function(t){this.rubix=t,this.root=this.rubix.root,this.data=this.rubix.data,this.width=this.rubix.width,this.height=this.rubix.height,this.area_series=this.rubix.root_area_series,this.show_markers=void 0===this.show_markers?this.rubix.show_markers:this.show_markers,this.master_detail=this.rubix.master_detail,this.master_detail&&(this.md_root=this.rubix.md_root),this.id||(this.id=this.rubix.uid("area"));var i=this;this.line=d3.svg.line(),this.line.defined(function(t){return null!==t.x&&null!==t.y}),this.line.x(function(t){return i.rubix.opts.invertAxes?i.rubix.x(t.y):"column"===i.rubix.axis.x.range||"bar"===i.rubix.axis.x.range?i.rubix.x(t.x)+i.rubix.x.rangeBand()/2:i.rubix.x(t.x)}),this.line.y(function(t){return i.rubix.opts.invertAxes?"column"===i.rubix.axis.y.range||"bar"===i.rubix.axis.y.range?i.rubix.y(t.x)+i.rubix.y.rangeBand()/2:i.rubix.y(t.x):i.rubix.y(t.y)}),this.line.interpolate(this.rubix.interpolate),this.area=d3.svg.area(),this.area.defined(this.line.defined()),this.rubix.opts.invertAxes?(this.area.x0(function(t){return i.rubix.x(0)}),this.area.x1(function(t){return i.rubix.x(t.y)}),this.area.y(function(t){return"column"===i.rubix.axis.y.range||"bar"===i.rubix.axis.y.range?i.rubix.y(t.x)+i.rubix.y.rangeBand()/2:i.rubix.y(t.x)}),this.area.interpolate(this.rubix.interpolate)):(this.area.x(function(t){return"column"===i.rubix.axis.x.range||"bar"===i.rubix.axis.x.range?i.rubix.x(t.x)+i.rubix.x.rangeBand()/2:i.rubix.x(t.x)}),this.area.y0(function(t){return i.rubix.y(0)}),this.area.y1(function(t){return i.rubix.y(t.y)}),this.area.interpolate(this.rubix.interpolate)),this.master_detail&&(this.master_line=d3.svg.line(),this.master_line.defined(function(t){return null!==t.x&&null!==t.y}),this.master_line.x(function(t){return i.rubix.opts.invertAxes?i.rubix.x2(t.y):i.rubix.x2(t.x)}),this.master_line.y(function(t){return i.rubix.opts.invertAxes?i.rubix.y2(t.x):i.rubix.y2(t.y)}),this.master_line.interpolate(this.rubix.interpolate),this.master_area=d3.svg.area(),this.master_area.defined(this.master_line.defined()),this.area.interpolate(this.rubix.interpolate),this.rubix.opts.invertAxes?(this.master_area.x0(function(t){return i.rubix.x2(0)}),this.master_area.x1(function(t){return i.rubix.x2(t.y)}),this.master_area.y(function(t){return i.rubix.y2(t.x)}),this.master_area.interpolate(this.rubix.interpolate)):(this.master_area.x(function(t){return i.rubix.x2(t.x)}),this.master_area.y0(function(t){return i.rubix.y2(0)}),this.master_area.y1(function(t){return i.rubix.y2(t.y)}),this.master_area.interpolate(this.rubix.interpolate)))},Rubix.AreaSeries.prototype.redraw=function(t){this._setup(t),this.draw()},Rubix.AreaSeries.prototype.noRedraw=function(t){this._setup(t),this.draw(!0)},Rubix.AreaSeries.prototype.addData=function(t){if(this.rubix.data_changed=!0,!(t instanceof Array)){if(!(t instanceof Object))throw new Error("Data must be an array or object");if(!t.hasOwnProperty("x")&&!t.hasOwnProperty("y"))throw new Error("Object must be in the form: {x: ..., y: ...}");t=[t]}t.length&&(this.rubix.opts.noSort||t.sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1}),this.data[this.name]=t,this.rubix.resetAxis(!1),this.rubix.forceRedraw(),this._animate_draw())},Rubix.AreaSeries.prototype.draw=function(t){if(this.name&&this.data&&this.data.hasOwnProperty(this.name)&&this.data[this.name].length){var i=this;this.area_series.selectAll("."+this.id)[0].length?this.rubix.runCommand("globalRedraw"):(this.area_series.selectAll("."+this.id+".clipped").remove(),this.opts.noshadow||(this.strokePath1=this.area_series.append("path").attr("class",this.id+" line").datum(this.data[this.name]).attr("d",this.line).attr("stroke","black").attr("fill","none").attr("stroke-linecap","round").attr("stroke-width",5*this.opts.strokewidth).attr("stroke-opacity",.05000000000000001).attr("transform","translate(1,1)"),this.strokePath2=this.area_series.append("path").attr("class",this.id+" line").datum(this.data[this.name]).attr("d",this.line).attr("stroke","black").attr("fill","none").attr("stroke-linecap","round").attr("stroke-width",3*this.opts.strokewidth).attr("stroke-opacity",.1).attr("transform","translate(1,1)"),this.strokePath3=this.area_series.append("path").attr("class",this.id+" line").datum(this.data[this.name]).attr("d",this.line).attr("stroke","black").attr("fill","none").attr("stroke-linecap","round").attr("stroke-width",1*this.opts.strokewidth).attr("stroke-opacity",.15000000000000002).attr("transform","translate(1,1)")),this.areaPath=this.area_series.append("path").attr("class",this.id+" area").datum(this.data[this.name]).attr("d",this.area).attr("fill",this.opts.color).attr("fill-opacity",this.opts.fillopacity).attr("stroke","none"),this.linePath=this.area_series.append("path").datum(this.data[this.name]).attr("class",this.id+" line").attr("stroke",this.opts.color).attr("fill","none").attr("stroke-linecap","round").attr("d",this.line).attr("stroke-width",2*this.opts.strokewidth),this.master_detail&&(this.md_root.select(".md-layers > .md_area_series").selectAll("."+this.id+".clipped").remove(),this.masterLinePath=this.md_root.select(".md-layers > .md_area_series").append("path").datum(this.data[this.name]).attr("class",this.id+" line").attr("stroke",this.opts.color).attr("fill","none").attr("stroke-linecap","round").attr("d",this.master_line).attr("stroke-width",2*this.opts.strokewidth),this.masterLinePath.attr("clip-path","url(#"+i.rubix.master_id+"-clip)"),this.masterLinePath.classed("clipped",!0),this.masterAreaPath=this.md_root.select(".md-layers > .md_area_series").append("path").attr("class",this.id+" area").datum(this.data[this.name]).attr("d",this.master_area).attr("fill",this.opts.color).attr("fill-opacity",this.opts.fillopacity).attr("stroke","none"),this.masterAreaPath.attr("clip-path","url(#"+i.rubix.master_id+"-clip)"),this.masterAreaPath.classed("clipped",!0),this.dataChanged&&(this.rubix.resetExtent(),this.dataChanged=!1),this.opts.noshadow||(this.strokePath1.attr("clip-path","url(#"+i.rubix.master_id+"-clip)"),this.strokePath2.attr("clip-path","url(#"+i.rubix.master_id+"-clip)"),this.strokePath3.attr("clip-path","url(#"+i.rubix.master_id+"-clip)")),this.linePath.attr("clip-path","url(#"+i.rubix.master_id+"-clip)"),this.opts.noshadow||(this.strokePath1.classed("clipped",!0),this.strokePath2.classed("clipped",!0),this.strokePath3.classed("clipped",!0)),this.linePath.classed("clipped",!0),this.areaPath.classed("clipped",!0)),this.areaPath.attr("clip-path","url(#"+i.rubix.master_id+"-clip)"),this.setup=!0),this.rubix.resetFocus(t)}},Rubix.AreaSeries.prototype.updatePoint=function(t,i,s){this.addPoint(t,i,s)},Rubix.AreaSeries.prototype.removePoint=function(t,i){if(this.chart_hidden)this.temp_stack.push({type:"removePoint",ref:t});else{this.data[this.name]||(this.data[this.name]=[]);for(var s=0;s<this.data[this.name].length;s++)if(this.data[this.name][s].x===t){this.data[this.name].splice(s,1),!0;break}this.master_detail&&(this.dataChanged=!0),i||(this.setup?this._animate_draw():(this.rubix.resetAxis(!0),this.rubix.forceRedraw()))}},Rubix.AreaSeries.prototype.addPoint=function(t,i,s){if(this.rubix.data_changed=!0,!(t instanceof Object)||t instanceof Array)throw new Error("Object required for addPoint");if(!t.hasOwnProperty("x")&&!t.hasOwnProperty("y"))throw new Error("Object must be in the form: {x: ..., y: ...}");if(this.chart_hidden)this.temp_stack.push({type:"addPoint",data:t,shift:i});else{this.data[this.name]||(this.data[this.name]=[]);for(var e=!1,a=0;a<this.data[this.name].length;a++)if(this.data[this.name][a].x===t.x){this.data[this.name][a].y=t.y,e=!0;break}e||this.data[this.name].push(t),this.data[this.name].sort(function(t,i){return t.x>i.x?1:t.x===i.x?0:-1}),this.rubix.opts.interval?this.rubix.opts.interval<this.data[this.name].length&&this.data[this.name].shift():i&&this.data[this.name].shift(),this.master_detail&&(this.dataChanged=!0),s||(this.setup?this._animate_draw():(this.rubix.resetAxis(!0),this.rubix.forceRedraw()))}},Rubix.AreaSeries.prototype._animate_draw=function(t){for(var i=this.root.selectAll(".y.axis").selectAll("text")[0],s=[],e=0;e<i.length;e++)s.push(i[e].getBBox().width);d3.max(s);this.rubix.resetAxis(!1),i=this.root.selectAll(".y.axis").selectAll("text")[0],s=[];for(e=0;e<i.length;e++)s.push(i[e].getBBox().width);var a=d3.max(s);this.rubix.marginLeft(a),this.rubix.resetFocus()},Rubix.AreaSeries.prototype.hidden=function(){this.chart_hidden=!0},Rubix.AreaSeries.prototype.show=function(){for(this.chart_hidden=!1;this.temp_stack.length>1;)"addPoint"===(t=this.temp_stack.shift()).type?this.addPoint(t.data,t.shift,!0):this.removePoint(t.ref);if(this.temp_stack.length){var t=this.temp_stack.shift();"addPoint"===t.type?this.addPoint(t.data,t.shift,!0):this.removePoint(t.ref)}},Rubix.AreaSeries.prototype.globalRedraw=function(t){this.area_series.selectAll("."+this.id+".line").attr("d",this.line),this.area_series.selectAll("."+this.id+".area").attr("d",this.area)},Rubix.AreaSeries.prototype.forceRedraw=function(t){this.redraw(t)},Rubix.AreaSeries.prototype.on_complete_draw=function(){if(this.setup){var t=this,i=this.data[this.name];if(void 0!==this.opts.marker&&this.show_markers)switch(this.master_detail&&this.rubix.symbols.attr("clip-path","url(#"+t.rubix.master_id+"-clip-symbols)"),this.markers=this.rubix.symbols.selectAll("."+this.id+"-marker"),this.opts.marker){case"circle":case"cross":case"square":case"diamond":case"triangle-up":case"triangle-down":var s=d3.svg.symbol();s.type(this.opts.marker);var e=this.markers.data(i);e.enter().append("path").attr("d",s).attr("class",this.id+"-marker").attr("fill",this.opts.color).style("display",function(t){return null===t.y?"none":null}).attr("stroke","white").attr("transform",function(i){var s=i.y;if(isNaN(s)&&(s=0),t.rubix.opts.invertAxes){var e=t.rubix.y(i.x),a=t.rubix.x(s);"column"!==t.rubix.axis.y.range&&"bar"!==t.rubix.axis.y.range||(e+=t.rubix.y.rangeBand()/2)}else{var e=t.rubix.y(s),a=t.rubix.x(i.x);"column"!==t.rubix.axis.x.range&&"bar"!==t.rubix.axis.x.range||(a+=t.rubix.x.rangeBand()/2)}return"translate("+a+","+e+")"}),e.exit().remove();break;default:throw new Error("Unknown marker type : "+this.opts.marker)}}},Rubix.AreaSeries.prototype.setupFocus=function(){if(this.setup)switch(this.focus&&this.focus.remove(),this.focus=this.rubix.focus_group.append("g"),this.focus.attr("class","focus"),this.focus.style("display","none"),this.opts.marker){case"circle":case"cross":case"square":case"diamond":case"triangle-up":case"triangle-down":var t=d3.svg.symbol();t.type(this.opts.marker);this.focus.append("path").attr("d",t).attr("fill",this.opts.color).attr("stroke","white").attr("stroke-width",2);break;default:throw new Error("Unknown marker type : "+this.opts.marker)}},Rubix.AreaSeries.prototype.on_focus=function(){this.setup&&this.linePath.attr("stroke-width",2*this.opts.strokewidth)},Rubix.AreaSeries.prototype.off_focus=function(){this.setup&&this.linePath.attr("stroke-width",2*this.opts.strokewidth)},Rubix.Cleanup=function(){for(var t=null,i=0;i<RubixListeners.length;i++)t=RubixListeners[i],$(window).off("orientationchange."+t),$(window).off("rubix.redraw."+t),$(window).off("resize.rubix."+t),$(window).off("debouncedresize.rubix."+t),$(window).off("throttledresize.rubix."+t);RubixListeners=[]},Rubix.redraw=function(){$(window).trigger("resize")};